[{"path":[]},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"our-pledge","dir":"","previous_headings":"","what":"Our Pledge","title":"Contributor Covenant Code of Conduct","text":"members, contributors, leaders pledge make participation community harassment-free experience everyone, regardless age, body size, visible invisible disability, ethnicity, sex characteristics, gender identity expression, level experience, education, socio-economic status, nationality, personal appearance, race, caste, color, religion, sexual identity orientation. pledge act interact ways contribute open, welcoming, diverse, inclusive, healthy community.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"our-standards","dir":"","previous_headings":"","what":"Our Standards","title":"Contributor Covenant Code of Conduct","text":"Examples behavior contributes positive environment community include: Demonstrating empathy kindness toward people respectful differing opinions, viewpoints, experiences Giving gracefully accepting constructive feedback Accepting responsibility apologizing affected mistakes, learning experience Focusing best just us individuals, overall community Examples unacceptable behavior include: use sexualized language imagery, sexual attention advances kind Trolling, insulting derogatory comments, personal political attacks Public private harassment Publishing others’ private information, physical email address, without explicit permission conduct reasonably considered inappropriate professional setting","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"enforcement-responsibilities","dir":"","previous_headings":"","what":"Enforcement Responsibilities","title":"Contributor Covenant Code of Conduct","text":"Community leaders responsible clarifying enforcing standards acceptable behavior take appropriate fair corrective action response behavior deem inappropriate, threatening, offensive, harmful. Community leaders right responsibility remove, edit, reject comments, commits, code, wiki edits, issues, contributions aligned Code Conduct, communicate reasons moderation decisions appropriate.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"scope","dir":"","previous_headings":"","what":"Scope","title":"Contributor Covenant Code of Conduct","text":"Code Conduct applies within community spaces, also applies individual officially representing community public spaces. Examples representing community include using official e-mail address, posting via official social media account, acting appointed representative online offline event.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"enforcement","dir":"","previous_headings":"","what":"Enforcement","title":"Contributor Covenant Code of Conduct","text":"Instances abusive, harassing, otherwise unacceptable behavior may reported community leaders responsible enforcement geoissong@gmail.com. complaints reviewed investigated promptly fairly. community leaders obligated respect privacy security reporter incident.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"enforcement-guidelines","dir":"","previous_headings":"","what":"Enforcement Guidelines","title":"Contributor Covenant Code of Conduct","text":"Community leaders follow Community Impact Guidelines determining consequences action deem violation Code Conduct:","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"id_1-correction","dir":"","previous_headings":"Enforcement Guidelines","what":"1. Correction","title":"Contributor Covenant Code of Conduct","text":"Community Impact: Use inappropriate language behavior deemed unprofessional unwelcome community. Consequence: private, written warning community leaders, providing clarity around nature violation explanation behavior inappropriate. public apology may requested.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"id_2-warning","dir":"","previous_headings":"Enforcement Guidelines","what":"2. Warning","title":"Contributor Covenant Code of Conduct","text":"Community Impact: violation single incident series actions. Consequence: warning consequences continued behavior. interaction people involved, including unsolicited interaction enforcing Code Conduct, specified period time. includes avoiding interactions community spaces well external channels like social media. Violating terms may lead temporary permanent ban.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"id_3-temporary-ban","dir":"","previous_headings":"Enforcement Guidelines","what":"3. Temporary Ban","title":"Contributor Covenant Code of Conduct","text":"Community Impact: serious violation community standards, including sustained inappropriate behavior. Consequence: temporary ban sort interaction public communication community specified period time. public private interaction people involved, including unsolicited interaction enforcing Code Conduct, allowed period. Violating terms may lead permanent ban.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"id_4-permanent-ban","dir":"","previous_headings":"Enforcement Guidelines","what":"4. Permanent Ban","title":"Contributor Covenant Code of Conduct","text":"Community Impact: Demonstrating pattern violation community standards, including sustained inappropriate behavior, harassment individual, aggression toward disparagement classes individuals. Consequence: permanent ban sort public interaction within community.","code":""},{"path":"https://kyle-messier.github.io/chopin/CODE_OF_CONDUCT.html","id":"attribution","dir":"","previous_headings":"","what":"Attribution","title":"Contributor Covenant Code of Conduct","text":"Code Conduct adapted Contributor Covenant, version 2.1, available https://www.contributor-covenant.org/version/2/1/code_of_conduct.html. Community Impact Guidelines inspired [Mozilla’s code conduct enforcement ladder][https://github.com/mozilla/inclusion]. answers common questions code conduct, see FAQ https://www.contributor-covenant.org/faq. Translations available https://www.contributor-covenant.org/translations.","code":""},{"path":"https://kyle-messier.github.io/chopin/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 chopin authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v00_good_practice_parallelization.html","id":"assumptions","dir":"Articles","previous_headings":"","what":"Assumptions","title":"Good practice of using `chopin` in HPC","text":"Users can access multi-threaded central processing units sufficient memory (.e., least 4GB/thread) Single-node calculation: version 0.3.0, chopin supports single-node","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/articles/v00_good_practice_parallelization.html","id":"minimize-errors","dir":"Articles","previous_headings":"Basic workflow","what":"Minimize errors","title":"Good practice of using `chopin` in HPC","text":"Consider using try() tryCatch() let error halt work without results, especially using higher-level functions","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v00_good_practice_parallelization.html","id":"raster-vector-overlay","dir":"Articles","previous_headings":"Basic workflow","what":"Raster-Vector overlay","title":"Good practice of using `chopin` in HPC","text":"Use chopin::par_make_gridset make exhaustive padded grid objects SpatVector class chopin::par_grid filters features intersect grid. Post-processing necessary polygons may taken twice parallelized calculation.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v00_good_practice_parallelization.html","id":"customization","dir":"Articles","previous_headings":"Basic workflow","what":"Customization","title":"Good practice of using `chopin` in HPC","text":"chopin way parallelize iterate calculation list use future.apply function extent vector element Preprocessed vector objects respect extent vector first list Preferably lists named Use file database table paths instead SpatRaster objects future parallel processing workflow","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v00_good_practice_parallelization.html","id":"save-computing-costs","dir":"Articles","previous_headings":"Basic workflow","what":"Save computing costs","title":"Good practice of using `chopin` in HPC","text":"HPC systems CPU-memory usage quota users profvis::profvis() helps summarize runtime per function call memory usage testing, use future::plan(future::sequential) see single-thread. Keep chopin::par_make_gridset arguments take one two grids using lapply. Preferably hardest case tested estimate maximum peak memory usage per thread. Submit job proper amount computational assets: HPC management system offers tools see statistics task summaries. Use records plan asset allocation next time.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v01_par_make_gridset.html","id":"prepare-input-data","dir":"Articles","previous_headings":"","what":"Prepare input data","title":"Generate computational grids","text":"plot chunk nc-load plot chunk nc-random","code":"library(chopin) library(dplyr) library(sf) library(terra) options(sf_use_s2 = FALSE) ncpoly <- system.file(\"shape/nc.shp\", package = \"sf\") ncsf <- sf::read_sf(ncpoly) ncsf <- sf::st_transform(ncsf, \"EPSG:5070\") plot(sf::st_geometry(ncsf)) ncpoints <- sf::st_sample(ncsf, 10000) plot(sf::st_geometry(ncpoints)) # st_sample output is st_sfc. We should convert it to sf ncpoints <- st_as_sf(ncpoints) ncpoints$pid <- seq(1, nrow(ncpoints))"},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/articles/v01_par_make_gridset.html","id":"visualize-computational-grids","dir":"Articles","previous_headings":"Computational grids","what":"Visualize computational grids","title":"Generate computational grids","text":"plot chunk grid-plain","code":"ncpoints_tr <- terra::vect(ncpoints) compregions <-   chopin::par_make_gridset(     ncpoints_tr,     mode = \"grid\",     nx = 8L,     ny = 5L,     padding = 1e4L   )  names(compregions) ## [1] \"original\" \"padded\" par(mfcol = c(1, 2)) plot(compregions$original, main = \"Original grids\") plot(compregions$padded, main = \"Padded grids\")"},{"path":"https://kyle-messier.github.io/chopin/articles/v01_par_make_gridset.html","id":"other-types-of-grids","dir":"Articles","previous_headings":"Computational grids","what":"Other types of grids","title":"Generate computational grids","text":"plot chunk grid-others","code":"# returns 5 by 5 grids compregions_q <-   chopin::par_make_gridset(     ncpoints_tr,     mode = \"grid_quantile\",     padding = 1e4L,     quantiles = par_def_q(5L)   )  par(mfcol = c(1, 2)) plot(compregions_q$original, main = \"Original grids (quantiles)\") plot(compregions_q$padded, main = \"Padded grids (quantiles)\")"},{"path":"https://kyle-messier.github.io/chopin/articles/v01_par_make_gridset.html","id":"clustered-points","dir":"Articles","previous_headings":"Computational grids","what":"Clustered points","title":"Generate computational grids","text":"Clustered points produce larger merged grids results mode = \"grid_advanced\". plot chunk grid-advanced plot chunk grid-advanced","code":"## advanced data(\"ncpoints\", package = \"chopin\") ncpoints <- sf::st_as_sf(ncpoints, coords = 1:2, crs = \"EPSG:5070\") plot(ncpoints$geometry, col = \"red\", cex = 0.5) compregions_a <-   chopin::par_make_gridset(     ncpoints,     mode = \"grid_advanced\",     padding = 1e4L,     nx = 15L, ny = 8L,     grid_min_features = 20L   ) par(mfcol = c(1, 2)) plot(compregions_a$original$geometry, main = \"Original grids (advanced)\") plot(compregions_a$padded$geometry, main = \"Padded grids (advanced)\")"},{"path":"https://kyle-messier.github.io/chopin/articles/v01_par_make_gridset.html","id":"notes","dir":"Articles","previous_headings":"Computational grids","what":"Notes","title":"Generate computational grids","text":"Computational grids exhaustive split entire study region. take square buffer grid clip target raster vector.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"document demonstrates parallelize weather/climate geospatial data processing chopin cases users may take advantage parallel processing . cover following formats: consider TerraClimate PRISM data data format . Parameter-elevation Regressions Independent Slopes Model (PRISM) high-resolution (800-1,000 meters) gridded climate dataset available BIL (band interleaved line) format readable GDAL. TerraClimate high-resolution (5 km) gridded climate dataset NetCDF format readable GDAL. spatial resolution TerraClimate data commensurates 5 km equator, whereas PRISM data approximately 1 km. data available NetCDF format readable GDAL. use terra package read data.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"prepare-target-datasets","dir":"Articles","previous_headings":"Introduction","what":"Prepare target datasets","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"consider populated places centroids mainland United States (.e., excluding Alaska, Hawaii, territories). use tigris package download data.","code":"pkgs <-   c(\"chopin\", \"terra\", \"stars\", \"sf\",     \"future\", \"doFuture\", \"dplyr\", \"parallelly\", \"tigris\", \"tictoc\") invisible(sapply(pkgs, library, character.only = TRUE, quietly = TRUE)) options(tigris_use_cache = TRUE, sf_use_s2 = FALSE)"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"hardware-specification","dir":"Articles","previous_headings":"Introduction","what":"Hardware specification","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"used machine 112 physical CPU cores 750 GB memory, used portion cores (20) demonstration. maximum possible memory usage set. However, typical HPC management systems, users required request number cores memory jobs. number cores memory capacity considered users parallelize extraction process.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"download","dir":"Articles","previous_headings":"Introduction > Download and preprocess","what":"Download","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"","code":"# populated places state <- tigris::states(year = 2022) statemain <-   state[!state$STUSPS %in% c(\"AK\", \"HI\", \"PR\", \"VI\", \"GU\", \"MP\", \"AS\"), ] target_states <- statemain$GEOID  popplace <-   lapply(target_states, function(x) tigris::places(x, year = 2022)) %>%   do.call(rbind, .) saveRDS(popplace, \"./input/populated_place_2022.rds\", compress = \"xz\")"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"read","dir":"Articles","previous_headings":"Introduction > Download and preprocess","what":"Read","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"","code":"state <- tigris::states(year = 2022) statemain <-   state[!state$STUSPS %in% c(\"AK\", \"HI\", \"PR\", \"VI\", \"GU\", \"MP\", \"AS\"), ] target_states <- statemain$GEOID  # prepared populated places popplace <- readRDS(\"./input/populated_place_2022.rds\")  # generate circular buffers with 10 km radius popplacep <- sf::st_centroid(popplace, of_largest_polygon = TRUE) %>%   sf::st_transform(\"EPSG:5070\") popplacep2 <- sf::st_centroid(popplace, of_largest_polygon = TRUE) popplaceb <- sf::st_buffer(popplacep, dist = units::set_units(10, \"km\"))"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"terraclimate","dir":"Articles","previous_headings":"","what":"TerraClimate","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"TerraClimate data provided yearly NetCDF files, contains monthly layers. read data terra package preprocess data extract annual mean sum bands types columns.","code":"# wbd ext_mainland <- c(xmin = -126, xmax = -64, ymin = 22, ymax = 51) ext_mainland <- terra::ext(ext_mainland)  path_tc <- file.path(\"input\", \"terraClimate\") path_tc_files <- list.files(   path = path_tc, pattern = \"*.nc$\",   full.names = TRUE ) path_tc_files #>   [1] \"input/terraClimate/TerraClimate_aet_2000.nc\"  #>  [2] \"input/terraClimate/TerraClimate_aet_2001.nc\" #>  [truncated] #> [321] \"input/terraClimate/TerraClimate_ws_2021.nc\"   #> [322] \"input/terraClimate/TerraClimate_ws_2022.nc\""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"preprocessing","dir":"Articles","previous_headings":"TerraClimate","what":"Preprocessing","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"Fourteen variables available TerraClimate data. table TerraClimate website. variables can categorized two types: summed averaged. Sum: aet, def, pet, ppt, q, soil, swe. Mean: PDSI, srad, tmax, tmin, vap, vpd, ws. Following rationale, preprocess data summing first seven layers averaging rest layers. code blocks follow “split-apply-combine” strategy. Note terra::tapp aggregates layers attributes time custom indices. \\[!WARNING\\] Stacking raster data may take long time consume large amount memory depending users’ area interest data resolution. Users need consider memory capacity system stacking rasters. 14 data elements 23 years 12 months . demonstrates summary data layers averaged circular buffer polygons 10 kilometers (10,000 meters) radius. leverage multiple cores machine, run future::availableCores() check number cores set number workers future::plan accordingly. Typically, two logical cores physical core modern central processing units. number workers set number physical cores machine optimal performance. example uses future::multicore shares memory across workers. \\[!CAUTION\\] Windows users RStudio users (platforms) able use future::multicore due restriction future package. Please future::multisession instead note option runs slower future::multicore case.","code":"options(future.globals = FALSE) # some bands should be summed bandnames <- c(   \"aet\", \"def\", \"PDSI\", \"pet\", \"ppt\", \"q\", \"soil\", \"srad\",   \"swe\", \"tmax\", \"tmin\", \"vap\", \"vpd\", \"ws\" ) bandnames_sorted <- sort(bandnames)  # single nc file, yearly aggregation by fun value # band for summation bandnames_sum <- c(\"aet\", \"def\", \"pet\", \"ppt\", \"q\", \"soil\", \"swe\")  # band for averaging bandnames_avg <- c(\"PDSI\", \"srad\", \"tmax\", \"tmin\", \"vap\", \"vpd\", \"ws\")  # mean: temporally marginal pixel mean (i.e., monthly -> yearly) # sum: temporally marginal pixel sum (i.e., monthly -> yearly) # Preprocessed data are stored in tictoc::tic(\"sum: 7 layers\") netcdf_read_sum <-   split(bandnames_sum, bandnames_sum) |>   lapply(function(x) {     grep(paste0(\"(\", x, \")\"), path_tc_files, value = TRUE)   }) |>   lapply(function(x) {     terra::tapp(terra::rast(x, win = ext_mainland, snap = \"out\"), index = \"years\", fun = \"sum\")   }) netcdf_read_sum <- Reduce(c, netcdf_read_sum) tictoc::toc() #> sum: 7 layers: 177.974 sec elapsed names(netcdf_read_sum) <- paste0(rep(bandnames_sum, each = 23), \"_\", rep(2000:2022, 7)) netcdf_read_sum #> class       : SpatRaster  #> dimensions  : 696, 1488, 161  (nrow, ncol, nlyr) #> resolution  : 0.04166667, 0.04166667  (x, y) #> extent      : -126, -64, 22, 51  (xmin, xmax, ymin, ymax) #> coord. ref. : +proj=longlat +ellps=WGS84 +no_defs  #> source(s)   : memory #> names       : aet_2000,  aet_2001,  aet_2002,  aet_2003, ...  #> min values  :     22.9,      27.3,        11,      30.8, ...  #> max values  :   1270.9,    1366.6,      1399,    1411.1, ...  #> time (years):   2000 to 2022 # tictoc::tic(\"mean: 7 layers\") # netcdf_read_mean <- #   split(bandnames_avg, bandnames_avg) |> #   lapply(function(x) { #     grep(paste0(\"(\", x, \")\"), path_tc_files, value = TRUE) #   }) |> #   lapply(function(x) { #     terra::tapp(terra::rast(x, win = ext_mainland, snap = \"out\"), index = \"years\", fun = \"mean\") #   }) |> #   Reduce(f = c, x = _) # tictoc::toc()  # names(netcdf_read_mean) <- #   sprintf(\"%s_%d\", rep(bandnames_avg, each = 23), rep(2000:2022, 7)) # netcdf_read_mean tic(\"multi threads (grid)\") doFuture::registerDoFuture() future::plan(future::multicore, workers = 8L) grid_init <-   chopin::par_make_gridset(     popplacep2,     mode = \"grid\",     padding = 1e4,     nx = 4L,     ny = 2L   ) multi_grid <-   chopin::par_grid(     grids = grid_init,     fun_dist = chopin::extract_at_buffer,     combine = dplyr::bind_rows,     points = popplacep2,     surf = netcdf_read_sum,     id = \"GEOID\",     func = \"mean\",     radius = 1e4   ) toc() #> multi threads (grid): 16.668 sec elapsed system.time(   multi <-     grep(       paste0(\"(\", paste(bandnames_sum, collapse = \"|\"), \")\"),       path_tc_files,       value = TRUE     ) %>%     chopin::par_multirasters(       filenames = .,       fun_dist = chopin::extract_at_buffer,       combine = dplyr::bind_cols,       points = popplacep2,       surf = rast(), # ignored       id = \"GEOID\",       func = \"mean\",       radius = 1e4     ) ) #>     user   system  elapsed  #> 5377.495  231.654  762.147 future::plan(future::sequential)   # single thread tic(\"single thread\") single <-   exactextractr::exact_extract(     netcdf_read_sum,     sf::st_as_sf(popplaceb),     fun = \"mean\",     stack_apply = TRUE,     force_df = TRUE,     append_cols = c(\"GEOID\"),     progress = FALSE   ) toc() #> single thread: 21.161 sec elapsed"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"prism-dataset","dir":"Articles","previous_headings":"","what":"PRISM dataset","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"PRISM data provided monthly 30-year normal BIL files. Assuming user wants summarize 30-year normal precipitation 10 kilometers circular buffers geogrpahic centroids US Census Places (p.26), demonstrate extraction process chopin package.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"download-1","dir":"Articles","previous_headings":"PRISM dataset > Download and preprocess","what":"Download","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"","code":"# populated places # mainland states state <- tigris::states(year = 2022) statemain <-   state[!state$STUSPS %in% c(\"AK\", \"HI\", \"PR\", \"VI\", \"GU\", \"MP\", \"AS\"), ] target_states <- statemain$GEOID  popplace <-   lapply(target_states, function(x) tigris::places(x, year = 2022)) %>%   do.call(rbind, .) saveRDS(popplace, \"./input/populated_place_2022.rds\", compress = \"xz\")"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"read-1","dir":"Articles","previous_headings":"PRISM dataset > Download and preprocess","what":"Read","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"\\[!IMPORTANT\\] chopin::par_make_gridset works best point datasets since grid clip input features parallelized. Polygon inputs result duplicate values output lead take longer complete.","code":"bils <- list.files(\"input\", \"bil$\", recursive = TRUE, full.names = TRUE) bilssds <- terra::rast(bils[-13]) popplace2 <- sf::st_transform(popplace, crs = terra::crs(bilssds)) popplaceb2 <- sf::st_transform(popplaceb, crs = terra::crs(bilssds))"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"grid-parallelization","dir":"Articles","previous_headings":"PRISM dataset","what":"Grid parallelization","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"vein TerraClimate data, use chopin package parallelize extraction process grid strategy.","code":"exgrid <-   chopin::par_make_gridset(     popplacep2,     mode = \"grid\",     padding = 1e4,     nx = 4L,     ny = 2L   )  doFuture::registerDoFuture() future::plan(future::multicore, workers = 8L)  system.time(   exmulti <-     chopin::par_grid(       exgrid,       fun_dist = chopin::extract_at_buffer,       points = popplacep2,       surf = bilssds,       radius = units::set_units(1e4, \"meter\"),       id = \"GEOID\",       func = \"mean\"     ) ) #> Your input function was successfully run at CGRIDID: 1 #> Your input function was successfully run at CGRIDID: 2 #> Your input function was successfully run at CGRIDID: 3 #> Your input function was successfully run at CGRIDID: 4 #> Your input function was successfully run at CGRIDID: 5 #> Your input function was successfully run at CGRIDID: 6 #> Your input function was successfully run at CGRIDID: 7 #> Your input function was successfully run at CGRIDID: 8 #>    user  system elapsed  #>  33.090  13.254  14.571 system.time(   exsingle <-     exactextractr::exact_extract(       bilssds,       popplaceb2,       fun = \"mean\",       stack_apply = TRUE,       force_df = TRUE,       append_cols = \"GEOID\",       max_cells_in_memory = 2.14e9,       progress = FALSE     ) ) #>    user  system elapsed  #>  19.347   1.927  21.716 future::plan(future::sequential)"},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"larger-buffer-sizes","dir":"Articles","previous_headings":"Scaled up examples","what":"Larger buffer sizes","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"Examples showed difference parallelized single-threaded extraction process significant. increase buffer size 50 kilometers compare performance parallelized single-threaded extraction process. \\[!NOTE\\] example used strings raster file paths surf argument chopin::extract_at_buffer. terra::rast multiple file paths return SpatRaster multiple layers rasters extent resolution.","code":"# make buffers popplaceb5 <- sf::st_buffer(popplacep, dist = units::set_units(50, \"km\")) %>%   sf::st_transform(terra::crs(bilssds))  system.time(   exsingle5 <-     exactextractr::exact_extract(       bilssds,       popplaceb5,       fun = \"mean\",       stack_apply = TRUE,       force_df = TRUE,       append_cols = \"GEOID\",       max_cells_in_memory = 2.14e9,       progress = FALSE     ) ) #>    user  system elapsed  #> 140.373   2.302 144.552 exgrid5k <-   chopin::par_make_gridset(     popplacep2,     mode = \"grid\",     padding = 5e4,     nx = 4L,     ny = 2L   )   doFuture::registerDoFuture() future::plan(future::multicore, workers = 8L)  system.time(   exmulti5k <-     chopin::par_grid(       exgrid5k,       fun_dist = chopin::extract_at_buffer,       points = popplacep2,       surf = bilssds,       radius = 5e4,       id = \"GEOID\",       func = \"mean\"     ) ) #> Your input function was successfully run at CGRIDID: 1 #> Your input function was successfully run at CGRIDID: 2 #> Your input function was successfully run at CGRIDID: 3 #> Your input function was successfully run at CGRIDID: 4 #> Your input function was successfully run at CGRIDID: 5 #> Your input function was successfully run at CGRIDID: 6 #> Your input function was successfully run at CGRIDID: 7 #> Your input function was successfully run at CGRIDID: 8 #>    user  system elapsed  #> 152.344  11.003  60.409 future::plan(future::sequential)"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"larger-number-of-features","dir":"Articles","previous_headings":"Scaled up examples","what":"Larger number of features","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"example uses 1,204,934 1-km grid points southeastern United States summarize seven layers TerraClimate. plot chunk se-states","code":"## generate 1km grid points in the southeastern US States stt <- tigris::states(year = 2020) targ_states <- c(\"NC\", \"SC\", \"GA\", \"FL\", \"AL\", \"MS\", \"TN\", \"LA\", \"AR\") stt_targ <- stt[stt$STUSPS %in% targ_states, ] plot(stt_targ$geometry) stt_t <- sf::st_transform(stt_targ, \"EPSG:5070\") stt_g <- sf::st_sample(stt_t, type = \"regular\", 1204934) stt_g <- sf::st_as_sf(stt_g) sf::st_geometry(stt_g) <- \"geometry\" stt_g$pid <- seq(1, nrow(stt_g)) stt_gb <- sf::st_buffer(stt_g, units::set_units(10, \"km\"))  tic() single_2m <-   exactextractr::exact_extract(     netcdf_read_sum,     stt_gb,     fun = \"mean\",     stack_apply = TRUE,     force_df = TRUE,     max_cells_in_memory = 2.14e9,     progress = FALSE   ) toc() #> 855.908 sec elapsed stt_gbg <-   chopin::par_make_gridset(     stt_g,     mode = \"grid\",     padding = 5e3,     nx = 5L,     ny = 5L   )   doFuture::registerDoFuture() future::plan(future::multicore, workers = 8L) system.time(   stt5k <-     chopin::par_grid(       stt_gbg,       fun_dist = chopin::extract_at_buffer,       points = stt_g,       surf = netcdf_read_sum,       id = \"pid\",       radius = 1e4,       func = \"mean\",       max_cells = 2e7     ) ) #>   user  system elapsed  #>  6.745   4.102 434.041 future::plan(future::sequential)"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"finely-resolved-vector","dir":"Articles","previous_headings":"Scaled up examples","what":"Finely resolved vector","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"Using PRISM data, example summarizes mean values data element census block groups.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"download-2","dir":"Articles","previous_headings":"Scaled up examples > Finely resolved vector","what":"Download","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"","code":"# set state=NULL and cb=TRUE will download the block groups for the entire US bg <- tigris::block_groups(state = NULL, cb = TRUE, year = 2020) sf::write_sf(bg, file.path(\"input\", \"Blockgroups_2020.gpkg\"))"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"extract","dir":"Articles","previous_headings":"Scaled up examples > Finely resolved vector","what":"Extract","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"","code":"## extract prism by par_hierarchy bgsf <- sf::st_read(\"input/Blockgroups_2020.gpkg\") #> Reading layer `Blockgroups_2020' from data source  #>   `/ddn/gs1/home/songi2/projects/chopin/input/Blockgroups_2020.gpkg'  #>   using driver `GPKG' #> Simple feature collection with 242298 features and 11 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -179.1467 ymin: -14.5487 xmax: 179.7785 ymax: 71.38782 #> Geodetic CRS:  NAD83 bgsf_main <- bgsf %>%   dplyr::filter(!STATEFP %in% c(\"02\", \"15\", \"72\", \"66\", \"78\", \"60\", \"69\"))  ## extract prism at bg system.time(   exsingle <-     exactextractr::exact_extract(       bilssds,       bgsf_main,       fun = \"mean\",       stack_apply = TRUE,       force_df = TRUE,       append_cols = \"GEOID\",       max_cells_in_memory = 2.14e9,       progress = FALSE     ) ) #>    user  system elapsed  #>  60.387   2.059  64.147 nmain <- c(\"AS\", \"AK\", \"HI\", \"PR\", \"VI\", \"GU\", \"MP\") stt_nmain <- stt[!stt$STUSPS %in% nmain, ]   doFuture::registerDoFuture() future::plan(multicore, workers = 20L) system.time(   exhierarchy <-     chopin::par_hierarchy(       bgsf_main,       split_level = \"STATEFP\",       fun_dist = chopin::extract_at_poly,       polys = bgsf_main,       surf = bilssds,       id = \"GEOID\"     ) ) #>    user  system elapsed  #>   2.205   0.558 158.905 future::plan(future::sequential)"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"finely-resolved-raster","dir":"Articles","previous_headings":"Scaled up examples","what":"Finely resolved raster","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"demonstrate extraction process CropScape dataset resolution 30 meters. case, use frac option exact_extract tabulates fraction area cell category covered polygon accounting partial coverage polygon segments raster cells. balancing computation time, split block groups nine subsets parallelize. Note mode = \"grid_quantile\" used par_make_gridset balance number block groups per grid. input argument par_make_gridset polygons, polygons duplicate rows output data.frame since block groups overlapping grid selected.","code":"cdl <- terra::rast(\"input/2022_cdls/2022_30m_cdls.tif\")  system.time(   bgsf_cdl_single <-     exactextractr::exact_extract(       cdl,       bgsf_main,       fun = \"frac\",       stack_apply = TRUE,       force_df = TRUE,       append_cols = \"GEOID\",       max_cells_in_memory = 2.14e9,       progress = FALSE     ) ) #>     user   system  elapsed  #> 1013.411   44.322 1369.053 pkgs <-   c(\"chopin\", \"terra\", \"stars\", \"sf\", \"future\", \"doFuture\", \"dplyr\", \"parallelly\", \"tigris\", \"tictoc\") invisible(sapply(pkgs, library, character.only = TRUE, quietly = TRUE)) options(tigris_use_cache = TRUE, sf_use_s2 = FALSE) cdl <- terra::rast(\"input/2022_cdls/2022_30m_cdls.tif\") bgsf <- sf::st_read(\"input/Blockgroups_2020.gpkg\") bgsf_main <- bgsf %>%   dplyr::filter(!STATEFP %in% c(\"02\", \"15\", \"72\", \"66\", \"78\", \"60\", \"69\"))   # balancing the number of features assigned per workers # by splitting block groups by splitting centroids bgsf_9grids_plain <- bgsf_main %>%   chopin::par_make_gridset(     mode = \"grid\",     nx = 3L, ny = 3L, padding = 1e4   ) bgsf_9grids <- bgsf_main %>%   chopin::par_make_gridset(     mode = \"grid_quantile\",     padding = 1e4,     quantiles = chopin::par_def_q(3L)   )  par(mfcol = c(1, 2)) plot(terra::vect(bgsf_9grids_plain$padded), main = \"Plain\") plot(bgsf_9grids$padded, main = \"Quantile\") par(mfcol = c(1, 1))   doFuture::registerDoFuture() future::plan(multicore, workers = 9L) # Note that bgsf_9grids were converted to sf # for exporting the objects to the parallel workers system.time(   bgsf_cdl_par <-     chopin::par_grid(       lapply(bgsf_9grids, sf::st_as_sf),       fun_dist = chopin::extract_at_poly,       poly = bgsf_main,       surf = cdl,       id = \"GEOID\",       func = \"frac\",       max_cells = 2e7     ) ) #> Your input function was successfully run at CGRIDID: 1 #> Your input function was successfully run at CGRIDID: 2 #> Your input function was successfully run at CGRIDID: 3 #> Your input function was successfully run at CGRIDID: 4 #> Your input function was successfully run at CGRIDID: 5 #> Your input function was successfully run at CGRIDID: 6 #> Your input function was successfully run at CGRIDID: 7 #> Your input function was successfully run at CGRIDID: 8 #> Your input function was successfully run at CGRIDID: 9 #>   user  system elapsed  #>  6.632   1.821 347.638"},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"discussion-which-strategy-is-better-stacked-vs-file-based-parallelization","dir":"Articles","previous_headings":"","what":"Discussion: which strategy is better? stacked vs file-based parallelization","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"\\[!NOTE\\] ’s users’ system specification size data. faster computation, two strategies. One parallelization implemented chopin example. strategy stack rasters extract values . Adjustment arguments exactextractr::exact_extract benefit many people dealing sizable data able stacked. compare two strategies terms computation time. proceeding, users need consider hardware specification. example, memory storage leverage maximal performance exact_extract. Specifically speaking, memory capacity crucial store stacked rasters memory rather read proxy rasters disk implemented terra. max_cells_in_memory key argument control memory usage. maximum possible value argument \\(2^{31} - 1 = 2,147,483,647\\), roughly 2.147e9, applied example . memory bandwidth much faster disk input/output specification, stacked rasters high max_cells_in_memory applied run faster file-based parallelization extraction lower value max_cells_in_memory. performance come without cost. memory-intensive setting suitable system limited memory, example, consumer laptops around 16 GB RAM.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"more-tips-to-save-time-and-memory","dir":"Articles","previous_headings":"Discussion: which strategy is better? stacked vs file-based parallelization","what":"More tips to save time and memory","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"Always consider stacking rasters large number separate raster files resolution extent machine’s memory capacity allows. Reading multiple raster files terra::rast automatically stack single SpatRaster object. \\[!NOTE\\] Stacking rasters usually takes large amount memory. Users need consider memory capacity system stacking rasters. Read vector data sf package first. bit faster terra save time processing exactextractr designed work sf objects vector inputs. users want use exactextractr raster-vector overlay, pre-cropping raster data may help saving time processing. exactextractr read raster data extent vector data ad hoc. analysis require high precision vector data, simplification geometries (e.g., using rmapshaper, .e., ms_simplify) result considerable time savings.","code":""},{"path":"https://kyle-messier.github.io/chopin/articles/v02_climate_examples.html","id":"see-also","dir":"Articles","previous_headings":"Discussion: which strategy is better? stacked vs file-based parallelization","what":"See also","title":"Extracting Weather/Climate Geospatial Data with `chopin`","text":"Garnett, R. (2023). Geospatial distributed processing furrr Dyba, K. (n.d.). Parallel raster processing stars","code":""},{"path":"https://kyle-messier.github.io/chopin/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Insang Song. Author, maintainer. Kyle Messier. Author, contributor.","code":""},{"path":"https://kyle-messier.github.io/chopin/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Song , Messier K (2024). chopin: CHOPIN: Computation Climate Health research Parallelized INfrastructure. R package version 0.5.0.20240311, https://github.com/kyle-messier/chopin.","code":"@Manual{,   title = {chopin: CHOPIN: Computation for Climate and Health research On Parallelized INfrastructure},   author = {Insang Song and Kyle Messier},   year = {2024},   note = {R package version 0.5.0.20240311},   url = {https://github.com/kyle-messier/chopin}, }"},{"path":[]},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"objective","dir":"","previous_headings":"Objective and target users","what":"Objective","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"package automates parallelization spatial operations chopin functions well sf/terra functions. GDAL-compatible files database tables, chopin functions help calculate spatial variables vector raster data external software requirements.","code":""},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"for-whom-chopin-is-useful","dir":"","previous_headings":"Objective and target users","what":"For whom chopin is useful","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Environmental health researchers data analysts Health geographers spatial epidemiologists Spatial analysts need perform geospatial operations large datasets Can run R functions following relevant instructions; basic knowledge geographic information system data models, coordinate systems transformations, spatial operations, raster-vector overlay; Understood planned want calculate; Collected datasets need","code":""},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"notes-on-data-restrictions","dir":"","previous_headings":"Objective and target users","what":"Notes on data restrictions","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"package works best two-dimensional (planar) geometries. Users disable s2 spherical geometry mode sf setting. Running chopin functions spherical three-dimensional (e.g., including M/Z dimensions) geometries may produce incorrect unexpected results.","code":"sf::sf_use_s2(FALSE)"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"basic-design","dir":"","previous_headings":"","what":"Basic design","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Processing functions accept sf/terra’s classes spatial data. Raster-vector overlay done exactextractr. extract_at_buffer: extract raster values circular buffers; kernel weight can applied extract_at_poly summarize_sedc: calculate sums exponentially decaying contributions summarize_aw: area-weighted covariates based target reference polygons par_grid: parallelize artificial grid polygons generated maximum extent inputs. par_make_gridset used generate grid polygons running function. par_hierarchy: parallelize hierarchy coded identifier fields (example, census blocks county US) par_multirasters: parallelize multiple raster files functions designed used future doFuture packages parallelize multiple CPU threads. Users can choose number threads used parallelization process. Users always need register parallel workers future doFuture running three functions .","code":"doFuture::registerDoFuture() future::plan(future::multicore, workers = 4L) # future::multisession, future::cluster are available, # See future.batchtools and future.callr for other options # the number of workers are up to users' choice"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"to-run-the-examples","dir":"","previous_headings":"","what":"To run the examples","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"RStudio: download open document press “Run Chunks ”, “Run Chunks ”, “Restart R Run Chunks”, whichever appropriate. Visual Studio Code (R extension): download open document press “Run ” last code chunk. prefer command line (.e., Unix-like operating systems), run:","code":"git clone https://github.com/Spatiotemporal-Exposures-and-Toxicology/chopin cd chopin Rscript -e \\ \" knitr::purl(\\\"README.Rmd\\\", \\\"README_run.r\\\") source(\\\"README_run.r\\\") \""},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"chopin can installed using remotes::install_github (also possible pak::pak devtools::install_github).","code":"# install.packages(\"remotes\") remotes::install_github(\"Spatiotemporal-Exposures-and-Toxicology/chopin\")"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"examples","dir":"","previous_headings":"","what":"Examples","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Examples navigate par_grid, par_hierarchy, par_multirasters functions chopin parallelize geospatial operations.","code":"# check and install packages to run examples pkgs <- c(\"chopin\", \"dplyr\", \"sf\", \"terra\",           \"future\", \"future.apply\", \"doFuture\", \"testthat\") # install packages if anything is unavailable rlang::check_installed(pkgs)  # disable spherical geometries # it does the same as sf::sf_use_s2(FALSE) options(sf_use_s2 = FALSE) # parallelization-safe random number generator set.seed(2024, kind = \"L'Ecuyer-CMRG\")"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"par_grid-parallelize-over-artificial-grid-polygons","dir":"","previous_headings":"Examples","what":"par_grid: parallelize over artificial grid polygons","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Please refer small example extracting mean altitude values circular point buffers census tracts North Carolina. running code chunks , set cloned chopin repository working directory setwd()","code":"ncpoly <- system.file(\"shape/nc.shp\", package = \"sf\") ncsf <- sf::read_sf(ncpoly) ncsf <- sf::st_transform(ncsf, \"EPSG:5070\") plot(sf::st_geometry(ncsf))"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"generate-random-points-in-nc","dir":"","previous_headings":"Examples > par_grid: parallelize over artificial grid polygons","what":"Generate random points in NC","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Ten thousands random point locations generated inside counties North Carolina.","code":"ncpoints <- sf::st_sample(ncsf, 1e4) ncpoints <- sf::st_as_sf(ncpoints) ncpoints$pid <- sprintf(\"PID-%05d\", seq(1, 1e4)) plot(sf::st_geometry(ncpoints))"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"target-raster-dataset-shuttle-radar-topography-mission","dir":"","previous_headings":"Examples > par_grid: parallelize over artificial grid polygons","what":"Target raster dataset: Shuttle Radar Topography Mission","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"use elevation dataset moderate spatial resolution (approximately 400 meters 0.25 miles).","code":"# data preparation wdir <- system.file(\"extdata\", package = \"chopin\") path_srtm <- file.path(wdir, \"nc_srtm15_otm.rds\")  # terra SpatRaster objects are wrapped when exported to rds file srtm <- terra::unwrap(readRDS(path_srtm)) terra::crs(srtm) <- \"EPSG:5070\" srtm #> class       : SpatRaster  #> dimensions  : 1534, 2281, 1  (nrow, ncol, nlyr) #> resolution  : 391.5026, 391.5026  (x, y) #> extent      : 1012872, 1905890, 1219961, 1820526  (xmin, xmax, ymin, ymax) #> coord. ref. : NAD83 / Conus Albers (EPSG:5070)  #> source(s)   : memory #> name        : file928c3830468b  #> min value   :        -3589.291  #> max value   :         1946.400 terra::plot(srtm) ncpoints_tr <- terra::vect(ncpoints) system.time(   ncpoints_srtm <-     chopin::extract_at(       vector = ncpoints_tr,       raster = srtm,       id = \"pid\",       mode = \"buffer\",       radius = 1e4L  # 10,000 meters (10 km)     ) ) #>    user  system elapsed  #>  11.238   0.302  11.578"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"generate-regular-grid-computational-regions","dir":"","previous_headings":"Examples > par_grid: parallelize over artificial grid polygons","what":"Generate regular grid computational regions","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"chopin::par_make_gridset takes spatial dataset generate regular grid polygons nx ny arguments padding. Users overlapping (degree radius) non-overlapping grids, utilized split locations target datasets sub-datasets efficient processing. compregions list object two elements named original (non-overlapping grid polygons) padded (overlapping padding). figures illustrate grid polygons without overlaps.","code":"compregions <-   chopin::par_make_gridset(     ncpoints_tr,     mode = \"grid\",     nx = 8L,     ny = 5L,     padding = 1e4L   ) names(compregions) #> [1] \"original\" \"padded\"  oldpar <- par() par(mfrow = c(2, 1)) terra::plot(compregions$original, main = \"Original grids\") terra::plot(compregions$padded, main = \"Padded grids\")"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"parallel-processing","dir":"","previous_headings":"Examples > par_grid: parallelize over artificial grid polygons","what":"Parallel processing","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Using grid polygons, distribute task averaging elevations 10,000 circular buffer polygons, generated random locations, 10 kilometers radius chopin::par_grid. Users always need register multiple CPU threads (logical cores) parallelization. Users can inject generic functions’ arguments (parameters) writing ellipsis (...) arguments, demonstrated :","code":"future::plan(future::multicore, workers = 4L) doFuture::registerDoFuture()  system.time(   ncpoints_srtm_mthr <-     chopin::par_grid(       grids = compregions,       grid_target_id = NULL,       fun_dist = chopin::extract_at,       vector = ncpoints_tr,       raster = srtm,       id = \"pid\",       mode = \"buffer\",       radius = 1e4L     ) ) #> Your input function was successfully run at CGRIDID: 1 #> Your input function was successfully run at CGRIDID: 2 #> Your input function was successfully run at CGRIDID: 3 #> Your input function was successfully run at CGRIDID: 4 #> Your input function was successfully run at CGRIDID: 5 #> Your input function was successfully run at CGRIDID: 6 #> Your input function was successfully run at CGRIDID: 7 #> Your input function was successfully run at CGRIDID: 8 #> Your input function was successfully run at CGRIDID: 9 #> Your input function was successfully run at CGRIDID: 10 #> Your input function was successfully run at CGRIDID: 11 #> Your input function was successfully run at CGRIDID: 12 #> Your input function was successfully run at CGRIDID: 13 #> Your input function was successfully run at CGRIDID: 14 #> Your input function was successfully run at CGRIDID: 15 #> Your input function was successfully run at CGRIDID: 16 #> Your input function was successfully run at CGRIDID: 17 #> Your input function was successfully run at CGRIDID: 18 #> Your input function was successfully run at CGRIDID: 19 #> Your input function was successfully run at CGRIDID: 20 #> Your input function was successfully run at CGRIDID: 21 #> Your input function was successfully run at CGRIDID: 22 #> Your input function was successfully run at CGRIDID: 23 #> Your input function was successfully run at CGRIDID: 24 #> Your input function was successfully run at CGRIDID: 25 #> Your input function was successfully run at CGRIDID: 26 #> Your input function was successfully run at CGRIDID: 27 #> Your input function was successfully run at CGRIDID: 28 #> Your input function was successfully run at CGRIDID: 29 #> Your input function was successfully run at CGRIDID: 30 #> Your input function was successfully run at CGRIDID: 31 #> Your input function was successfully run at CGRIDID: 32 #> Your input function was successfully run at CGRIDID: 33 #>    user  system elapsed  #>  10.439   1.675   4.036 colnames(ncpoints_srtm_mthr)[2] <- \"mean_par\" ncpoints_compar <- merge(ncpoints_srtm, ncpoints_srtm_mthr) # Are the calculations equal? all.equal(ncpoints_compar$mean, ncpoints_compar$mean_par) #> [1] TRUE ncpoints_s <-     merge(ncpoints, ncpoints_srtm) ncpoints_m <-     merge(ncpoints, ncpoints_srtm_mthr)  plot(ncpoints_s[, \"mean\"], main = \"Single-thread\", pch = 19, cex = 0.33) plot(ncpoints_m[, \"mean_par\"], main = \"Multi-thread\", pch = 19, cex = 0.33)"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"chopinpar_hierarchy-parallelize-geospatial-computations-using-intrinsic-data-hierarchy","dir":"","previous_headings":"Examples","what":"chopin::par_hierarchy: parallelize geospatial computations using intrinsic data hierarchy","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"real world datasets, usually nested/exhaustive hierarchies. example, land organized administrative/jurisdictional borders multiple levels exist. U.S. context, state consists several counties, counties split census tracts, group block groups. chopin::par_hierarchy leverages hierarchies parallelize geospatial operations, means group lower-level geographic units higher-level geography assigned process. demonstration shows census tracts grouped counties county processed CPU thread.","code":""},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"read-data","dir":"","previous_headings":"Examples > chopin::par_hierarchy: parallelize geospatial computations using intrinsic data hierarchy","what":"Read data","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"","code":"path_nchrchy <- file.path(wdir, \"nc_hierarchy.gpkg\")  nc_data <- path_nchrchy nc_county <- sf::st_read(nc_data, layer = \"county\") #> Reading layer `county' from data source  #>   `/tmp/RtmpxBiRZZ/temp_libpath21d6e06d07aab7/chopin/extdata/nc_hierarchy.gpkg'  #>   using driver `GPKG' #> Simple feature collection with 100 features and 1 field #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176 #> Projected CRS: NAD83 / Conus Albers nc_tracts <- sf::st_read(nc_data, layer = \"tracts\") #> Reading layer `tracts' from data source  #>   `/tmp/RtmpxBiRZZ/temp_libpath21d6e06d07aab7/chopin/extdata/nc_hierarchy.gpkg'  #>   using driver `GPKG' #> Simple feature collection with 2672 features and 1 field #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176 #> Projected CRS: NAD83 / Conus Albers  # reproject to Conus Albers Equal Area nc_county <- sf::st_transform(nc_county, \"EPSG:5070\") nc_tracts <- sf::st_transform(nc_tracts, \"EPSG:5070\") nc_tracts$COUNTY <- substr(nc_tracts$GEOID, 1, 5)"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"extract-average-srtm-elevations-by-single-and-multiple-threads","dir":"","previous_headings":"Examples > chopin::par_hierarchy: parallelize geospatial computations using intrinsic data hierarchy","what":"Extract average SRTM elevations by single and multiple threads","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"","code":"# single-thread system.time(   nc_elev_tr_single <-     chopin::extract_at(       vector = nc_tracts,       raster = srtm,       id = \"GEOID\",       mode = \"polygon\"     ) ) #>    user  system elapsed  #>   1.936   0.036   1.979  # hierarchical parallelization system.time(   nc_elev_tr_distr <-     chopin::par_hierarchy(       regions = nc_county, # higher level geometry       split_level = \"GEOID\", # higher level unique id       fun_dist = chopin::extract_at,       vector = nc_tracts, # lower level geometry       raster = srtm,       id = \"GEOID\", # lower level unique id       func = \"mean\"     ) ) #>    user  system elapsed  #>   0.037   0.018   2.584"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"par_multirasters-parallelize-over-multiple-rasters","dir":"","previous_headings":"Examples","what":"par_multirasters: parallelize over multiple rasters","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"common case large group raster files operation performed. chopin::par_multirasters cases. example demonstrates five elevation raster files calculate average elevation counties North Carolina.","code":"nccnty <- terra::vect(nc_data, layer = \"county\") ncelev <- terra::unwrap(readRDS(path_srtm)) terra::crs(ncelev) <- \"EPSG:5070\" names(ncelev) <- c(\"srtm15\") tdir <- tempdir()  terra::writeRaster(ncelev, file.path(tdir, \"test1.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test2.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test3.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test4.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test5.tif\"), overwrite = TRUE)  # check if the raster files were exported as expected testfiles <- list.files(tdir, pattern = \"*.tif$\", full.names = TRUE) testfiles #> [1] \"/tmp/Rtmpt4JvoB/test1.tif\" \"/tmp/Rtmpt4JvoB/test2.tif\" #> [3] \"/tmp/Rtmpt4JvoB/test3.tif\" \"/tmp/Rtmpt4JvoB/test4.tif\" #> [5] \"/tmp/Rtmpt4JvoB/test5.tif\" system.time(   res <-     chopin::par_multirasters(       filenames = testfiles,       fun_dist = chopin::extract_at_poly,       polys = nccnty,       surf = ncelev,       id = \"GEOID\",       func = \"mean\"     ) ) #>    user  system elapsed  #>   1.732   0.586   1.095 knitr::kable(head(res)) # remove temporary raster files file.remove(testfiles) #> [1] TRUE TRUE TRUE TRUE TRUE"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"parallelization-of-a-generic-geospatial-operation","dir":"","previous_headings":"","what":"Parallelization of a generic geospatial operation","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"chopin internal macros, chopin::par_* functions support generic geospatial operations. example uses terra::nearest, gets nearest feature’s attributes, inside chopin::par_grid. figure shows padded grids (50 kilometers), primary roads, points. Primary roads selected padded grid per iteration used calculate distance point nearest primary road. Padded grids overlapping areas look different according padding argument chopin::par_make_gridset.  compare results single-thread multi-thread calculation. example, one wants calculate nearest interstate rural homes fine grids, grids may interstates homes grids get distance nearest interstate. problems can avoided choosing nx, ny, padding values par_make_gridset meticulously.","code":"path_ncrd1 <- file.path(wdir, \"ncroads_first.gpkg\")  # Generate 5000 random points pnts <- sf::st_sample(ncsf, 5000) pnts <- sf::st_as_sf(pnts) # assign identifiers pnts$pid <- sprintf(\"RPID-%04d\", seq(1, 5000)) pnts <- terra::vect(pnts) rd1 <- terra::vect(path_ncrd1)  # reproject pnts <- terra::project(pnts, \"EPSG:5070\") rd1 <- terra::project(rd1, \"EPSG:5070\")  # generate grids nccompreg <-   chopin::par_make_gridset(     input = pnts,     mode = \"grid\",     nx = 4L,     ny = 2L,     padding = 5e4L   ) # plot terra::plot(nccompreg$padded, border = \"orange\") terra::plot(terra::vect(ncsf), add = TRUE) terra::plot(rd1, col = \"blue\", add = TRUE) terra::plot(pnts, add = TRUE, cex = 0.3) legend(1.02e6, 1.72e6,        legend = c(\"Computation grids (50km padding)\", \"Major roads\"),        lty = 1, lwd = 1, col = c(\"orange\", \"blue\"),        cex = 0.5) # terra::nearest run system.time(   restr <- terra::nearest(x = pnts, y = rd1) ) #>    user  system elapsed  #>   0.894   0.005   0.901  # we use four threads that were configured above system.time(   res <-     chopin::par_grid(       grids = nccompreg,       fun_dist = terra::nearest,       x = pnts,       y = rd1     ) ) #> Your input function was successfully run at CGRIDID: 1 #> Your input function was successfully run at CGRIDID: 2 #> Your input function was successfully run at CGRIDID: 3 #> Your input function was successfully run at CGRIDID: 4 #> Your input function was successfully run at CGRIDID: 5 #> Your input function was successfully run at CGRIDID: 6 #> Your input function was successfully run at CGRIDID: 7 #> Your input function was successfully run at CGRIDID: 8 #>    user  system elapsed  #>   1.030   0.531   0.559 resj <- merge(restr, res, by = c(\"from_x\", \"from_y\")) all.equal(resj$distance.x, resj$distance.y) #> [1] TRUE"},{"path":"https://kyle-messier.github.io/chopin/index.html","id":"why-parallelization-is-slower-than-the-ordinary-function-run","dir":"","previous_headings":"","what":"Why parallelization is slower than the ordinary function run?","title":"CHOPIN: Computation for Climate and Health research On Parallelized\n    INfrastructure","text":"Parallelization may underperform datasets small take advantage divide--compute approach, parallelization overhead involved. Overhead refers required amount computational resources transferring objects multiple processes. Since demonstrations use quite small datasets, advantage parallelization noticeable expected. large amount data (spatial/temporal resolution number files, example) processed, users see efficiency package. illustrative truly scaled examples provided vignettes manuscripts near future.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":null,"dir":"Reference","previous_headings":"","what":"Detect classes in function arguments — any_class_args","title":"Detect classes in function arguments — any_class_args","text":"R function defined ordinary fashion (.e., assigning function <- function(...)) subject ambiguity particularly function name generic function name(s). function supports detecting classes arguments loosely defined function.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Detect classes in function arguments — any_class_args","text":"","code":"any_class_args(args = NULL, search = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Detect classes in function arguments — any_class_args","text":"args list, preferably generated list(...) inside function. search character(1). Class name search. Partial match supported.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Detect classes in function arguments — any_class_args","text":"logical vector.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Detect classes in function arguments — any_class_args","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/any_class_args.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Detect classes in function arguments — any_class_args","text":"","code":"df <- data.frame(a = 1, b = 3) any_class_args(list(df), \"data.frame\") #> [1] TRUE"},{"path":"https://kyle-messier.github.io/chopin/reference/clip_ras_ext.html","id":null,"dir":"Reference","previous_headings":"","what":"Clip input raster with a buffered vector extent. — clip_ras_ext","title":"Clip input raster with a buffered vector extent. — clip_ras_ext","text":"Clip input raster expected maximum extent computation.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/clip_ras_ext.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Clip input raster with a buffered vector extent. — clip_ras_ext","text":"","code":"clip_ras_ext(pnts = NULL, radius = NULL, ras = NULL, nqsegs = 180L)"},{"path":"https://kyle-messier.github.io/chopin/reference/clip_ras_ext.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Clip input raster with a buffered vector extent. — clip_ras_ext","text":"pnts sf SpatVector object radius numeric(1). buffer radius. value automatically multiplied 1.25 ras SpatRaster object clipped nqsegs integer(1). number points per quarter circle","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/clip_ras_ext.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Clip input raster with a buffered vector extent. — clip_ras_ext","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/clip_ras_ext.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Clip input raster with a buffered vector extent. — clip_ras_ext","text":"","code":"library(terra) #> terra 1.7.71  ras_rand <- terra::rast(nrow = 20, ncol = 20) terra::values(ras_rand) <- runif(400L) ras_rand_p <-   data.frame(     x = c(3, 5, 3.2, 8),     y = c(12, 10, 15, 12),     z = c(0, 1, 2, 3)   ) ras_rand_p <- terra::vect(ras_rand_p, geom = c(\"x\", \"y\")) clip_ras_ext(ras_rand_p, 1.5, ras_rand) #> class       : SpatRaster  #> dimensions  : 2, 1, 1  (nrow, ncol, nlyr) #> resolution  : 18, 9  (x, y) #> extent      : 0, 18, 0, 18  (xmin, xmax, ymin, ymax) #> coord. ref. : lon/lat WGS 84  #> source(s)   : memory #> name        :     lyr.1  #> min value   : 0.8666157  #> max value   : 0.9528248"},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":null,"dir":"Reference","previous_headings":"","what":"Clip to the buffered extent of input vector — clip_vec_ext","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"Clip input vector expected maximum extent computation.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"","code":"clip_vec_ext(pnts, radius, target_input)"},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"pnts sf SpatVector object radius numeric(1). Circular buffer radius. value automatically multiplied 1.1 target_input sf SpatVector object clipped","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"clipped sf SpatVector object.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/clip_vec_ext.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Clip to the buffered extent of input vector — clip_vec_ext","text":"","code":"library(sf) #> Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE library(stars) #> Loading required package: abind library(terra) options(sf_use_s2 = FALSE)  bcsd_path <- system.file(package = \"stars\", \"nc/bcsd_obs_1999.nc\") bcsd <- stars::read_stars(bcsd_path) #> pr, tas,  bcsd <- sf::st_as_sf(bcsd) bcsd_rpnt <- sf::st_as_sf(sf::st_sample(bcsd, 4L)) bcsd_rpntm <- sf::st_as_sf(sf::st_sample(bcsd, 1000L)) clip_vec_ext(bcsd_rpntm, 1000, bcsd_rpnt) #> Clip target features with the input feature extent... #> Simple feature collection with 4 features and 0 fields #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: -82.93117 ymin: 33.02974 xmax: -77.41361 ymax: 34.6201 #> CRS:           NA #>                            x #> 1 POINT (-81.62004 34.58888) #> 2  POINT (-77.41361 34.6201) #> 3 POINT (-82.93117 33.02974) #> 4 POINT (-80.22347 34.50031)"},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":null,"dir":"Reference","previous_headings":"","what":"Check Coordinate Reference System — crs_check","title":"Check Coordinate Reference System — crs_check","text":"returns st_crs object sf/Spat* objects.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check Coordinate Reference System — crs_check","text":"","code":"crs_check(x = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check Coordinate Reference System — crs_check","text":"x sf/stars/SpatVector/SpatRaster object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check Coordinate Reference System — crs_check","text":"st_crs crs object.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Check Coordinate Reference System — crs_check","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/crs_check.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check Coordinate Reference System — crs_check","text":"","code":"# data library(sf) ncpath = system.file(\"shape/nc.shp\", package = \"sf\") nc = read_sf(ncpath) crs_check(nc) #> Coordinate Reference System: #>   User input: NAD27  #>   wkt: #> GEOGCRS[\"NAD27\", #>     DATUM[\"North American Datum 1927\", #>         ELLIPSOID[\"Clarke 1866\",6378206.4,294.978698213898, #>             LENGTHUNIT[\"metre\",1]]], #>     PRIMEM[\"Greenwich\",0, #>         ANGLEUNIT[\"degree\",0.0174532925199433]], #>     CS[ellipsoidal,2], #>         AXIS[\"latitude\",north, #>             ORDER[1], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>         AXIS[\"longitude\",east, #>             ORDER[2], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>     ID[\"EPSG\",4267]]"},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":null,"dir":"Reference","previous_headings":"","what":"Return the input's GIS data model type — datamod","title":"Return the input's GIS data model type — datamod","text":"function returns one 'vector' 'raster' depending input class.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Return the input's GIS data model type — datamod","text":"","code":"datamod(input)"},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Return the input's GIS data model type — datamod","text":"input Spat*/sf/stars object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Return the input's GIS data model type — datamod","text":"character(1). One \"vector\" \"raster\".","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Return the input's GIS data model type — datamod","text":"Although stars object little ambiguous whether classify vector raster, considered raster package.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Return the input's GIS data model type — datamod","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/datamod.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Return the input's GIS data model type — datamod","text":"","code":"library(sf) library(terra) options(sf_use_s2 = FALSE)  nc_path <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc_sf <- sf::st_read(nc_path) #> Reading layer `nc.gpkg' from data source  #>   `/home/runner/work/_temp/Library/sf/gpkg/nc.gpkg' using driver `GPKG' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 datamod(nc_sf) #> [1] \"vector\"  ra_path <- system.file(\"ex/elev.tif\", package = \"terra\") ra <- terra::rast(ra_path) datamod(ra) #> [1] \"raster\""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":null,"dir":"Reference","previous_headings":"","what":"Return the package the input object is based on — dep_check","title":"Return the package the input object is based on — dep_check","text":"Detect whether input object sf Spat* object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Return the package the input object is based on — dep_check","text":"","code":"dep_check(input)"},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Return the package the input object is based on — dep_check","text":"input Spat* terra sf object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Return the package the input object is based on — dep_check","text":"character object; one \"terra\" \"sf\"","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Return the package the input object is based on — dep_check","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_check.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Return the package the input object is based on — dep_check","text":"","code":"library(sf) library(terra) options(sf_use_s2 = FALSE)  nc_path <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc_sf <- sf::st_read(nc_path) #> Reading layer `nc.gpkg' from data source  #>   `/home/runner/work/_temp/Library/sf/gpkg/nc.gpkg' using driver `GPKG' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 dep_check(nc_sf) #> [1] \"sf\" nc_vect <- terra::vect(nc_sf) dep_check(nc_vect) #> [1] \"terra\" ## END OF EXAMPLE"},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":null,"dir":"Reference","previous_headings":"","what":"Switch spatial data class — dep_switch","title":"Switch spatial data class — dep_switch","text":"Convert class sf/stars-terra","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Switch spatial data class — dep_switch","text":"","code":"dep_switch(input)"},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Switch spatial data class — dep_switch","text":"input Spat* terra sf object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Switch spatial data class — dep_switch","text":"Data converted package class (sf, terra; terra, sf)","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Switch spatial data class — dep_switch","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/dep_switch.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Switch spatial data class — dep_switch","text":"","code":"library(sf) library(stars) library(terra) options(sf_use_s2 = FALSE)  ## generate a random raster ras_rand <- terra::rast(nrow = 30, ncol = 30) terra::values(ras_rand) <- runif(900) stars_rand <- dep_switch(ras_rand) stars_rand #> stars object with 2 dimensions and 1 attribute #> attribute(s): #>               Min.  1st Qu.    Median      Mean   3rd Qu.      Max. #> lyr.1  0.002977239 0.267624 0.4937182 0.5006182 0.7345819 0.9977391 #> dimension(s): #>   from to offset delta refsys x/y #> x    1 30   -180    12 WGS 84 [x] #> y    1 30     90    -6 WGS 84 [y] # should return stars object  vec_rand <- terra::spatSample(ras_rand, size = 10L, as.points = TRUE) sf_rand <- dep_switch(vec_rand) sf_rand #> Simple feature collection with 10 features and 1 field #> Geometry type: POINT #> Dimension:     XY #> Bounding box:  xmin: -162 ymin: -69 xmax: 150 ymax: 45 #> Geodetic CRS:  WGS 84 #>        lyr.1         geometry #> 1  0.6226255   POINT (-162 3) #> 2  0.6969408   POINT (-66 -3) #> 3  0.5969548    POINT (30 33) #> 4  0.1762442    POINT (138 3) #> 5  0.2826658   POINT (150 39) #> 6  0.5825950 POINT (-126 -69) #> 7  0.9565204  POINT (-126 15) #> 8  0.3923108   POINT (102 45) #> 9  0.1054764     POINT (-6 3) #> 10 0.8319061    POINT (-18 9) # should return sf object"},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate a rectangular polygon from extent — ext2poly","title":"Generate a rectangular polygon from extent — ext2poly","text":"Generate rectangular polygon extent","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate a rectangular polygon from extent — ext2poly","text":"","code":"ext2poly(extent = NULL, output_class = c(\"sf\", \"terra\"), crs = \"EPSG:4326\")"},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate a rectangular polygon from extent — ext2poly","text":"extent input extent. numeric vector xmin/xmax/ymin/ymax, sf::st_bbox terra::ext outputs. output_class character(1). Class output polygon. One \"sf\" \"terra\" crs character(1). Coordinate reference system definition.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate a rectangular polygon from extent — ext2poly","text":"sf SpatVector object rectangular polygon.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Generate a rectangular polygon from extent — ext2poly","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ext2poly.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate a rectangular polygon from extent — ext2poly","text":"","code":"library(sf) library(terra) numext1 <- c(-100, -70, 30, 40) names(numext1) <- c(\"xmin\", \"xmax\", \"ymin\", \"ymax\") ext2poly(numext1, \"sf\") #> Simple feature collection with 1 feature and 0 fields #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: -100 ymin: 30 xmax: -70 ymax: 40 #> Geodetic CRS:  WGS 84 #>                                x #> 1 POLYGON ((-100 30, -70 30, ... ext2poly(numext1, \"terra\") #>  class       : SpatVector  #>  geometry    : polygons  #>  dimensions  : 1, 0  (geometries, attributes) #>  extent      : -100, -70, 30, 40  (xmin, xmax, ymin, ymax) #>  coord. ref. : lon/lat WGS 84 (EPSG:4326)"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract raster values with point buffers or polygons — extract_at","title":"Extract raster values with point buffers or polygons — extract_at","text":"Extract raster values point buffers polygons","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract raster values with point buffers or polygons — extract_at","text":"","code":"extract_at(   vector = NULL,   raster = NULL,   id = NULL,   func = \"mean\",   mode = c(\"polygon\", \"buffer\"),   ... )"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract raster values with point buffers or polygons — extract_at","text":"vector sf/SpatVector object. raster SpatRaster object. file path(s) extensions GDAL-compatible. id character(1). Unique identifier point. func function taking one numeric vector argument. mode one \"polygon\" (generic polygons extract raster values ) \"buffer\" (point buffer radius) ... various. Passed extract_at_buffer. See ?extract_at_buffer details.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract raster values with point buffers or polygons — extract_at","text":"data.frame object summarized raster values respect mode (polygon buffer) function.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Extract raster values with point buffers or polygons — extract_at","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract raster values with point buffers or polygons — extract_at","text":"","code":"## See ?extract_at_poly and ?extract_at_buffer"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"simplicity, assumed coordinate systems points raster .","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"","code":"extract_at_buffer(   points = NULL,   surf = NULL,   radius = NULL,   id = NULL,   qsegs = 90L,   func = \"mean\",   kernel = NULL,   bandwidth = NULL,   max_cells = 2e+07 )  extract_at_buffer_flat(   points = NULL,   surf = NULL,   radius = NULL,   id = NULL,   qsegs = NULL,   func = \"mean\",   kernel = NULL,   bandwidth = NULL,   max_cells = 2e+07 )  extract_at_buffer_kernel(   points = NULL,   surf = NULL,   radius = NULL,   id = NULL,   qsegs = NULL,   func = stats::weighted.mean,   kernel = NULL,   bandwidth = NULL,   max_cells = 2e+07 )"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"points sf/SpatVector object. Coordinates buffers generated. surf SpatRaster object file path(s) extensions GDAL-compatible. raster summary calculated radius numeric(1). Buffer radius. assume circular buffers id character(1). Unique identifier point. qsegs integer(1). Number vertices quarter circle. Default 90L. func function taking numeric vector argument. kernel character(1). Name kernel function One \"uniform\", \"triweight\", \"quartic\", \"epanechnikov\" bandwidth numeric(1). Kernel bandwidth. max_cells integer(1). Maximum number cells memory. See exactextractr::exact_extract details.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"data.frame object mean value","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"Sys.setenv(\"CHOPIN_FORCE_CROP\" = \"TRUE\") set, raster cropped extent polygons (snap = \"\"). note, function designed work exactextractr package. Arguments exactextractr::exact_extract set (default otherwise listed): force_df = TRUE stack_apply = TRUE max_cells_in_memory = 2e8 progress = FALSE","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_buffer.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract summarized values from raster with points and a buffer radius — extract_at_buffer","text":"","code":"library(terra) rrast <- terra::rast(nrow = 100, ncol = 100) terra::crs(rrast) <- \"EPSG:5070\" terra::values(rrast) <- rgamma(1e4, 4, 2) rpnt <- terra::spatSample(rrast, 100L, as.points = TRUE) rpnt$pid <- sprintf(\"id_%03d\", seq(1, 100)) extract_at_buffer(rpnt, rrast, 4, \"pid\") #>        pid     mean #> 1   id_001 1.651610 #> 2   id_002 1.375360 #> 3   id_003 1.869488 #> 4   id_004 1.879870 #> 5   id_005 1.830806 #> 6   id_006 2.203978 #> 7   id_007 2.025010 #> 8   id_008 2.104624 #> 9   id_009 2.044772 #> 10  id_010 1.882280 #> 11  id_011 1.506968 #> 12  id_012 2.049565 #> 13  id_013 1.596740 #> 14  id_014 2.027810 #> 15  id_015 1.891467 #> 16  id_016 2.026121 #> 17  id_017 1.724052 #> 18  id_018 1.845675 #> 19  id_019 1.516506 #> 20  id_020 1.870031 #> 21  id_021 1.701714 #> 22  id_022 2.313477 #> 23  id_023 2.263182 #> 24  id_024 1.995274 #> 25  id_025 2.431489 #> 26  id_026 2.374461 #> 27  id_027 2.080226 #> 28  id_028 1.700923 #> 29  id_029 1.962064 #> 30  id_030 2.107451 #> 31  id_031 2.165406 #> 32  id_032 2.240682 #> 33  id_033 2.274774 #> 34  id_034 2.040657 #> 35  id_035 1.396226 #> 36  id_036 1.964290 #> 37  id_037 1.866187 #> 38  id_038 1.559619 #> 39  id_039 1.822197 #> 40  id_040 1.903492 #> 41  id_041 2.117386 #> 42  id_042 1.392489 #> 43  id_043 2.339543 #> 44  id_044 2.585882 #> 45  id_045 1.813985 #> 46  id_046 2.156444 #> 47  id_047 1.653794 #> 48  id_048 1.688204 #> 49  id_049 1.952219 #> 50  id_050 2.010062 #> 51  id_051 2.029783 #> 52  id_052 2.473734 #> 53  id_053 2.347674 #> 54  id_054 1.847772 #> 55  id_055 1.885386 #> 56  id_056 2.378431 #> 57  id_057 2.591648 #> 58  id_058 2.317759 #> 59  id_059 1.790030 #> 60  id_060 1.946267 #> 61  id_061 1.878067 #> 62  id_062 1.625792 #> 63  id_063 1.669429 #> 64  id_064 2.041649 #> 65  id_065 2.333508 #> 66  id_066 1.969423 #> 67  id_067 1.440952 #> 68  id_068 2.481989 #> 69  id_069 1.950975 #> 70  id_070 1.949170 #> 71  id_071 1.800481 #> 72  id_072 1.727038 #> 73  id_073 1.856413 #> 74  id_074 2.165578 #> 75  id_075 2.798059 #> 76  id_076 2.008407 #> 77  id_077 1.824913 #> 78  id_078 2.024015 #> 79  id_079 1.740571 #> 80  id_080 2.040131 #> 81  id_081 2.149531 #> 82  id_082 2.495682 #> 83  id_083 2.375884 #> 84  id_084 1.835961 #> 85  id_085 1.960443 #> 86  id_086 2.293348 #> 87  id_087 2.268371 #> 88  id_088 2.319497 #> 89  id_089 1.744779 #> 90  id_090 1.748024 #> 91  id_091 2.193364 #> 92  id_092 2.249387 #> 93  id_093 2.230290 #> 94  id_094 2.054080 #> 95  id_095 2.208818 #> 96  id_096 1.823460 #> 97  id_097 1.687319 #> 98  id_098 1.775530 #> 99  id_099 1.922610 #> 100 id_100 2.047888"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract summarized values from raster with generic polygons — extract_at_poly","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"simplicity, assumed coordinate systems points raster .","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"","code":"extract_at_poly(   polys = NULL,   surf = NULL,   id = NULL,   func = \"mean\",   max_cells = 2e+07 )"},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"polys sf/SpatVector object. Polygons. surf SpatRaster object file path(s) extensions GDAL-compatible. raster summary calculated id character(1). Unique identifier point. func generic function name string function taking two arguments compatible exact_extract. example, \"mean\" \\(x, w) weighted.mean(x, w, na.rm = TRUE) max_cells integer(1). Maximum number cells memory. See exactextractr::exact_extract details.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"data.frame object function value","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"Sys.setenv(\"CHOPIN_FORCE_CROP\" = \"TRUE\") set, raster cropped extent polygons (snap = \"\"). note, function designed work exactextractr package. Arguments exactextractr::exact_extract set (default otherwise listed except max_cells_in_memory, set max_cells argument): force_df = TRUE stack_apply = TRUE progress = FALSE","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/extract_at_poly.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract summarized values from raster with generic polygons — extract_at_poly","text":"","code":"ncpath <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc <- terra::vect(ncpath) nc <- terra::project(nc, \"EPSG:5070\") rrast <- terra::rast(nc, nrow = 100, ncol = 220) ncr <- terra::rasterize(nc, rrast) terra::values(rrast) <- rgamma(2.2e4, 4, 2) rpnt <- terra::spatSample(rrast, 16L, as.points = TRUE) rpnt$pid <- sprintf(\"ID-%02d\", seq(1, 16)) rpoly <-   terra::buffer(rpnt, 5, capstyle = \"square\", joinstyle = \"bevel\") extract_at_poly(rpoly, rrast, \"pid\") #>      pid      mean #> 1  ID-01 1.3605092 #> 2  ID-02 2.2859938 #> 3  ID-03 1.5757203 #> 4  ID-04 2.2192740 #> 5  ID-05 2.4626040 #> 6  ID-06 1.3844070 #> 7  ID-07 4.8444252 #> 8  ID-08 2.0995440 #> 9  ID-09 0.7677558 #> 10 ID-10 2.1429260 #> 11 ID-11 2.7326655 #> 12 ID-12 1.1205804 #> 13 ID-13 1.3867524 #> 14 ID-14 1.1439190 #> 15 ID-15 0.8089886 #> 16 ID-16 2.1020586"},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":null,"dir":"Reference","previous_headings":"","what":"Setting the clipping extent — get_clip_ext","title":"Setting the clipping extent — get_clip_ext","text":"Return clipping extent buffer radius. assumes input CRS projected linear unit meters.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setting the clipping extent — get_clip_ext","text":"","code":"get_clip_ext(pnts, radius)"},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setting the clipping extent — get_clip_ext","text":"pnts One sf SpatVector object. Target points computation. radius numeric(1). Buffer radius. assumed meters","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Setting the clipping extent — get_clip_ext","text":"terra::ext sfc_POLYGON object computation extent.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Setting the clipping extent — get_clip_ext","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/get_clip_ext.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Setting the clipping extent — get_clip_ext","text":"","code":"library(sf) library(terra) options(sf_use_s2 = FALSE)  nc_path <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc_sf <- sf::st_read(nc_path) #> Reading layer `nc.gpkg' from data source  #>   `/home/runner/work/_temp/Library/sf/gpkg/nc.gpkg' using driver `GPKG' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 nc_sf <- sf::st_transform(nc_sf, \"EPSG:5070\") get_clip_ext(nc_sf, 2.5e4) #> Geometry set for 1 feature  #> Geometry type: POLYGON #> Dimension:     XY #> Bounding box:  xmin: 1026793 ymin: 1320525 xmax: 1860999 ymax: 1716736 #> Projected CRS: NAD83 / Conus Albers #> POLYGON ((1026793 1320525, 1860999 1320525, 186... nc_vect <- terra::vect(nc_sf) get_clip_ext(nc_vect, 2.5e4) #> SpatExtent : 1026793.1576511, 1860998.50656683, 1320525.36229524, 1716735.54884167 (xmin, xmax, ymin, ymax)"},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"One common errors spatial computation rooted entirely partly incomparable spatial extents input datasets. function returns whether data inside target computational extent. assumed know exact computational region. function return TRUE reference region completely contains data's extent FALSE otherwise.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"","code":"is_bbox_within_reference(data_query = NULL, reference = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"data_query sf*/stars/SpatVector/SpatRaster object. reference sf*/stars/SpatVector/SpatRaster object","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"logical(1). TRUE (queried data extent completely within reference bounding box) FALSE","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_bbox_within_reference.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check if the data extent is inside the reference bounding box — is_bbox_within_reference","text":"","code":"library(sf) ncpath <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc <- sf::st_read(ncpath) #> Reading layer `nc.gpkg' from data source  #>   `/home/runner/work/_temp/Library/sf/gpkg/nc.gpkg' using driver `GPKG' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 nc <- sf::st_transform(nc, \"EPSG:4326\")  refextnum <- c(-100, -60, 20, 40) names(refextnum) <- c(\"xmin\", \"xmax\", \"ymin\", \"ymax\") refext <- ext2poly(refextnum) is_bbox_within_reference(nc, refext) #> Coordinate Reference System: #>   User input: EPSG:4326  #>   wkt: #> GEOGCRS[\"WGS 84\", #>     DATUM[\"World Geodetic System 1984\", #>         ELLIPSOID[\"WGS 84\",6378137,298.257223563, #>             LENGTHUNIT[\"metre\",1]]], #>     PRIMEM[\"Greenwich\",0, #>         ANGLEUNIT[\"degree\",0.0174532925199433]], #>     CS[ellipsoidal,2], #>         AXIS[\"geodetic latitude (Lat)\",north, #>             ORDER[1], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>         AXIS[\"geodetic longitude (Lon)\",east, #>             ORDER[2], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>     USAGE[ #>         SCOPE[\"Horizontal component of 3D system.\"], #>         AREA[\"World.\"], #>         BBOX[-90,-180,90,180]], #>     ID[\"EPSG\",4326]] #> Coordinate Reference System: #>   User input: EPSG:4326  #>   wkt: #> GEOGCRS[\"WGS 84\", #>     DATUM[\"World Geodetic System 1984\", #>         ELLIPSOID[\"WGS 84\",6378137,298.257223563, #>             LENGTHUNIT[\"metre\",1]]], #>     PRIMEM[\"Greenwich\",0, #>         ANGLEUNIT[\"degree\",0.0174532925199433]], #>     CS[ellipsoidal,2], #>         AXIS[\"geodetic latitude (Lat)\",north, #>             ORDER[1], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>         AXIS[\"geodetic longitude (Lon)\",east, #>             ORDER[2], #>             ANGLEUNIT[\"degree\",0.0174532925199433]], #>     USAGE[ #>         SCOPE[\"Horizontal component of 3D system.\"], #>         AREA[\"World.\"], #>         BBOX[-90,-180,90,180]], #>     ID[\"EPSG\",4326]] #> although coordinates are longitude/latitude, st_within assumes that they are #> planar #> [1] TRUE"},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"Check boundary vector/raster object inside reference","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"","code":"is_within_ref(input_object, reference)"},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"input_object sf/stars/SpatVector/SpatRaster object. reference sf/stars/SpatVector/SpatRaster object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"logical","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/is_within_ref.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check if the boundary of the vector/raster object is inside the reference — is_within_ref","text":"","code":"library(sf) sf_use_s2(FALSE) ncpath <- system.file(\"shape/nc.shp\", package = \"sf\") nc <- sf::read_sf(ncpath) nc <- sf::st_transform(nc, \"EPSG:4326\") mainland_vec <- c(xmin = -128, xmax = -62, ymin = 22, ymax = 52) mainland_box <- ext2poly(mainland_vec, output_class = \"sf\") within_res <- is_within_ref(nc, mainland_box) #> although coordinates are longitude/latitude, st_covered_by assumes that they #> are planar within_res #> [1] TRUE"},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":null,"dir":"Reference","previous_headings":"","what":"Kernel functions — kernelfunction","title":"Kernel functions — kernelfunction","text":"Kernel functions","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Kernel functions — kernelfunction","text":"","code":"kernelfunction(   d,   bw,   kernel = c(\"uniform\", \"quartic\", \"triweight\", \"epanechnikov\") )"},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Kernel functions — kernelfunction","text":"d Distance bw Bandwidth kernel kernel Kernel type. One \"uniform\", \"quartic\", \"triweight\", \"epanechnikov\"","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Kernel functions — kernelfunction","text":"numeric. Kernel weights.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Kernel functions — kernelfunction","text":"SpatialKDE source","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/kernelfunction.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Kernel functions — kernelfunction","text":"","code":"v_dist <- c(1, 10, 100, 25, 50, 0.1) bw_dist1 <- 1 bw_dist2 <- 10 kernelfunction(v_dist, bw_dist1, \"uniform\") #> [1] 0.5 0.0 0.0 0.0 0.0 0.5 kernelfunction(v_dist, bw_dist1, \"quartic\") #> [1] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.9188437 kernelfunction(v_dist, bw_dist1, \"triweight\") #> [1] 0.000 0.000 0.000 0.000 0.000 0.999 kernelfunction(v_dist, bw_dist1, \"epanechnikov\") #> [1] 0.0000 0.0000 0.0000 0.0000 0.0000 0.7425 kernelfunction(v_dist, bw_dist2, \"uniform\") #> [1] 0.5 0.5 0.0 0.0 0.0 0.5 kernelfunction(v_dist, bw_dist2, \"quartic\") #> [1] 0.9188437 0.0000000 0.0000000 0.0000000 0.0000000 0.9373125 kernelfunction(v_dist, bw_dist2, \"triweight\") #> [1] 0.999000 0.000000 0.000000 0.000000 0.000000 0.999999 kernelfunction(v_dist, bw_dist2, \"epanechnikov\") #> [1] 0.742500 0.000000 0.000000 0.000000 0.000000 0.749925"},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":null,"dir":"Reference","previous_headings":"","what":"Mildly clustered points in North Carolina, United States — ncpoints","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"Mildly clustered points North Carolina, United States","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"","code":"ncpoints"},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"data frame 2,304 rows two variables: X X coordinate Y Y coordinate","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"sf package data nc","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"Coordinates EPSG:5070 (Conus Albers Equal Area)","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/ncpoints.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Mildly clustered points in North Carolina, United States — ncpoints","text":"","code":"data(\"ncpoints\", package = \"chopin\")"},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":null,"dir":"Reference","previous_headings":"","what":"Partition coordinates into quantile polygons — par_cut_coords","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"Partition coordinates quantile polygons","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"","code":"par_cut_coords(x = NULL, y = NULL, quantiles)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"x numeric/sf/SpatVector. x-coordinates (numeric). y numeric. y-coordinates. quantiles numeric vector. Quantiles.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"SpatVector object field CGRIDID.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"function two-dimensional points.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_cut_coords.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Partition coordinates into quantile polygons — par_cut_coords","text":"","code":"library(terra) random_points <-   data.frame(x = runif(1000, 0, 100), y = runif(1000, 0, 100)) quantiles <- par_def_q(4L) qpoly <- par_cut_coords(random_points$x, random_points$y, quantiles) clustered_points <-   data.frame(x = rgamma(1000, 1, 1), y = rgamma(1000, 4, 1)) qpoly_c <- par_cut_coords(clustered_points$x, clustered_points$y, quantiles) par(mfcol = c(1, 2)) plot(qpoly) plot(qpoly_c)  par(mfcol = c(1, 1)) cvect <- terra::vect(clustered_points, geom = c(\"x\", \"y\")) plot(cvect) plot(qpoly_c, add = TRUE, col = \"transparent\", border = \"red\")  qcv <- intersect(cvect, qpoly_c) table(qcv$CGRIDID) #>  #>  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16  #> 56 62 68 64 73 58 56 63 60 60 62 68 61 70 64 55  sum(table(qcv$CGRIDID)) # should be 1000 #> [1] 1000"},{"path":"https://kyle-messier.github.io/chopin/reference/par_def_q.html","id":null,"dir":"Reference","previous_headings":"","what":"Quantile definition — par_def_q","title":"Quantile definition — par_def_q","text":"Quantile definition","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_def_q.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Quantile definition — par_def_q","text":"","code":"par_def_q(steps = 4L)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_def_q.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Quantile definition — par_def_q","text":"steps integer(1). number quantiles.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_def_q.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Quantile definition — par_def_q","text":"numeric vector quantiles.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_def_q.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Quantile definition — par_def_q","text":"","code":"par_def_q(5L) #> [1] 0.0 0.2 0.4 0.6 0.8 1.0"},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":null,"dir":"Reference","previous_headings":"","what":"Parallelization error fallback — par_fallback","title":"Parallelization error fallback — par_fallback","text":"Parallelization error fallback","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Parallelization error fallback — par_fallback","text":"","code":"par_fallback(err = NULL, fun = NULL, debug = FALSE)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Parallelization error fallback — par_fallback","text":"err Error status message. fun function. debug logical(1). Print error messages (TRUE) (FALSE)","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Parallelization error fallback — par_fallback","text":"data.frame one column","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Parallelization error fallback — par_fallback","text":"function assumes fun argument named \"id\".","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Parallelization error fallback — par_fallback","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_fallback.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Parallelization error fallback — par_fallback","text":"","code":"err <- simpleError(\"No input.\") par_fallback(err, extract_at, debug = TRUE) #> <simpleError: No input.> #>   NULL #> 1   NA"},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":null,"dir":"Reference","previous_headings":"","what":"Process a given function in the entire or partial computational grids — par_grid","title":"Process a given function in the entire or partial computational grids — par_grid","text":"future::multicore, future::multisession, future::cluster doParallel::registerDoParallel parallelize work grid. details terminology future package, refer plan. function assumes users one raster file sizable spatially distributed target locations. thread process nearest integer $|N_g| / |N_t|$ grids $|N_g|$ denotes number grids $|N_t|$ denotes number threads.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process a given function in the entire or partial computational grids — par_grid","text":"","code":"par_grid(   grids,   grid_target_id = NULL,   debug = FALSE,   combine = dplyr::bind_rows,   fun_dist,   ... )"},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process a given function in the entire or partial computational grids — par_grid","text":"grids sf/SpatVector object. Computational grids. takes strict assumption grid input output par_make_gridset grid_target_id character(1) numeric(2). Default NULL. NULL, grid_ids used. \"id_from:id_to\" format c(unique(grid_id)[id_from], unique(grid_id)[id_to]) debug logical(1). Prints error messages errors calculation. combine function. function combine results. Default dplyr::bind_rows. fun_dist sf, terra chopin functions. ... Arguments passed argument fun_dist. second place get vector raster dataset want extract calculate values. example, raster dataset vector-raster overlay performed.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process a given function in the entire or partial computational grids — par_grid","text":"data.frame object computation results. entries results, consult function used fun_dist argument.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Process a given function in the entire or partial computational grids — par_grid","text":"dynamic dots (...), first second arguments fun_dist arguments sf/SpatVector objects accepted. Virtually sf/terra functions accept two arguments can put fun_dist, please advised spatial operations necessarily give exact result done single-thread. example, distance calculated function may return lower value actual computational region reduced. case especially target features spatially sparsely distributed.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Process a given function in the entire or partial computational grids — par_grid","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_grid.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Process a given function in the entire or partial computational grids — par_grid","text":"","code":"if (FALSE) { ncpath <- system.file(\"shape/nc.shp\", package = \"sf\") ncpoly <- terra::vect(ncpath) |>   terra::project(\"EPSG:5070\") ncpnts <-   readRDS(     system.file(\"extdata/nc_random_point.rds\", package = \"chopin\")   ) ncpnts <- terra::vect(ncpnts) ncpnts <- terra::project(ncpnts, \"EPSG:5070\") ncelev <-   terra::unwrap(     readRDS(system.file(\"extdata/nc_srtm15_otm.rds\", package = \"chopin\"))   ) terra::crs(ncelev) <- \"EPSG:5070\" names(ncelev) <- c(\"srtm15\")  ncsamp <-   terra::spatSample(     terra::ext(ncelev),     1e4L,     lonlat = FALSE,     as.points = TRUE   ) ncsamp$kid <- sprintf(\"K-%05d\", seq(1, nrow(ncsamp))) nccompreg <-   par_make_gridset(     input = ncpnts,     mode = \"grid\",     nx = 6L,     ny = 4L,     padding = 3e4L   ) res <-   par_grid(     grids = nccompreg,     grid_target_id = NULL,     fun_dist = extract_at_buffer,     points = ncpnts,     surf = ncelev,     qsegs = 90L,     radius = 5e3L,     id = \"pid\"   ) }"},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Process a given function using a hierarchy in input data — par_hierarchy","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"\"Hierarchy\" refers system, divides entire study region multiple subregions. oftentimes reflected area code system (e.g., FIPS US Census geographies, HUC-4, -6, -8, etc.). future::multicore, future::multisession, future::cluster doParallel::registerDoParallel parallelize work grid. details terminology future package, refer plan. function assumes users one raster file sizable spatially distributed target locations. thread process number lower level features higher level feature. Please advised accessing file simultaneously multiple processes may result errors.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"","code":"par_hierarchy(   regions,   split_level = NULL,   debug = FALSE,   combine = dplyr::bind_rows,   fun_dist,   ... )"},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"regions sf/SpatVector object. Computational regions. polygons accepted. split_level character(nrow(regions)) character(1). regions split common level value. level higher original data level. field name higher level information also accepted. debug logical(1). Prints error messages errors calculation. combine function. function combine results. fun_dist sf, terra, chopin functions. ... Arguments passed argument fun_dist. second place get vector raster dataset want extract calculate values. example, raster dataset vector-raster overlay performed.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"data.frame object computation results. entries results, consult function used fun_dist argument.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"dynamic dots (...), first second arguments fun_dist arguments sf/SpatVector objects accepted. Virtually sf/terra functions accept two arguments can put fun_dist, please advised spatial operations necessarily give exact result done single-thread. example, distance calculated function may return lower value actual computational region reduced. case especially target features spatially sparsely distributed.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_hierarchy.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Process a given function using a hierarchy in input data — par_hierarchy","text":"Insang Song geoissong@gmail.com","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate grid polygons — par_make_grid","title":"Generate grid polygons — par_make_grid","text":"Returns sf object includes x- y- index using two inputs ncutsx ncutsy, x- y-directional splits, respectively.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate grid polygons — par_make_grid","text":"","code":"par_make_grid(points_in = NULL, ncutsx = NULL, ncutsy = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate grid polygons — par_make_grid","text":"points_in sf SpatVector object. Target points computation. ncutsx integer(1). number splits along x-axis. ncutsy integer(1). number splits along y-axis.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate grid polygons — par_make_grid","text":"sf SpatVector object computation grids unique grid id (CGRIDID).","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Generate grid polygons — par_make_grid","text":"Grids generated based extent points_in first, exhaustive grids filtered intersection points_in. Thus, number generated grids may smaller ncutsx * ncutsy.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Generate grid polygons — par_make_grid","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_grid.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Generate grid polygons — par_make_grid","text":"","code":"library(sf) library(terra) options(sf_use_s2 = FALSE)  nc_path <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc <- terra::vect(nc_path) nc_rp <- terra::spatSample(nc, 1000) nc_gr <- par_make_grid(nc_rp, 10L, 6L)  plot(nc_rp) plot(nc_gr, add = TRUE)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":null,"dir":"Reference","previous_headings":"","what":"Get a set of computational grids — par_make_gridset","title":"Get a set of computational grids — par_make_gridset","text":"Using input points, bounding box split predefined numbers columns rows. grid buffered radius.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get a set of computational grids — par_make_gridset","text":"","code":"par_make_gridset(   input,   mode = c(\"grid\", \"grid_advanced\", \"density\", \"grid_quantile\"),   nx = 10L,   ny = 10L,   grid_min_features = 30L,   padding = NULL,   unit = NULL,   quantiles = NULL,   ... )"},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get a set of computational grids — par_make_gridset","text":"input sf Spat* object. mode character(1). Mode region construction. One \"grid\" (simple grid regardless number features grid) \"density\" (clustering-based varying grids), \"grid_advanced\" (merging adjacent grids smaller number features grid_min_features). argument grid_min_features specified. \"grid_quantile\" (x y quantiles): argument quantiles specified. nx integer(1). number grids along x-axis. ny integer(1). number grids along y-axis. grid_min_features integer(1). threshold merging adjacent grids padding numeric(1). extrusion factor make buffer clip actual datasets. Depending length unit CRS input. unit character(1). length unit padding (optional). units::set_units used padding sf object used. See units package vignette (web) list acceptable unit forms. quantiles numeric. Quantiles grid_quantile mode. ... arguments passed internal function","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get a set of computational grids — par_make_gridset","text":"list two, original: exhaustive non-overlapping grid polygons class input padded: square buffer polygon original. Used computation.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Get a set of computational grids — par_make_gridset","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_make_gridset.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get a set of computational grids — par_make_gridset","text":"","code":"# data library(sf) ncpath <- system.file(\"shape/nc.shp\", package = \"sf\") nc <- read_sf(ncpath) nc <- st_transform(nc, \"EPSG:5070\") # run: nx and ny should strictly be integers # In the example below, nx is 12L, not 12. nc_comp_region <-   par_make_gridset(     nc,     mode = \"grid\",     nx = 12L, ny = 8L,     padding = 10000) par(mfcol = c(1, 2)) plot(nc_comp_region$original)  plot(nc_comp_region$padded)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":null,"dir":"Reference","previous_headings":"","what":"Merge adjacent grid polygons with given rules — par_merge_grid","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"Merge boundary-sharing (\"Rook\" contiguity) grids fewer target features threshold. function strongly assumes input returned par_make_grid, \"CGRIDID\" unique id field.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"","code":"par_merge_grid(points_in = NULL, grid_in = NULL, grid_min_features = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"points_in sf SpatVector object. Target points computation. grid_in sf SpatVector object. grid generated par_make_grid. grid_min_features integer(1). Threshold merge adjacent grids.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"sf SpatVector object computation grids.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"Polsby, D. D., & Popper, F. J. (1991). Third Criterion: Compactness Procedural Safeguard Partisan Gerrymandering. Yale Law & Policy Review, 9(2), 301–353. Link","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_merge_grid.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Merge adjacent grid polygons with given rules — par_merge_grid","text":"","code":"if (FALSE) { library(sf) library(igraph) ligrary(dplyr) dg <- sf::st_as_sfc(st_bbox(c(xmin = 0, ymin = 0, xmax = 8e5, ymax = 6e5))) sf::st_crs(dg) <- 5070 dgs <- sf::st_as_sf(st_make_grid(dg, n = c(20, 15))) dgs$CGRIDID <- seq(1, nrow(dgs))  dg_sample <- sf::st_sample(dg, kappa = 5e-9, mu = 15, scale = 15000, type = \"Thomas\") sf::st_crs(dg_sample) <- sf::st_crs(dg) dg_merged <- par_merge_grid(sf::st_as_sf(dg_sample), dgs, 100) plot(dg_merged$geometry) #### NOT RUN #### }"},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":null,"dir":"Reference","previous_headings":"","what":"Process a given function over multiple large rasters — par_multirasters","title":"Process a given function over multiple large rasters — par_multirasters","text":"Large raster files usually exceed memory capacity size. function can helpful process heterogenous raster files homogeneous summary functions. Heterogenous raster files refer rasters different spatial extents resolutions. Cropping large raster small subset even consumes lot memory adds processing time. function leverages terra SpatRaster proxy distribute computation jobs multiple cores. assumed users multiple large raster files disk, file path assigned thread. thread directly read raster values disk using C++ pointers operate terra functions. use, strongly recommended use vector data small confined spatial extent computation avoid --memory error. , users may need make subsets input vector objects advance.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process a given function over multiple large rasters — par_multirasters","text":"","code":"par_multirasters(   filenames,   debug = FALSE,   combine = dplyr::bind_rows,   fun_dist,   ... )"},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process a given function over multiple large rasters — par_multirasters","text":"filenames character(n). vector list full file paths raster files. n total number raster files. debug logical(1). Prints error messages errors calculation. combine function. function combine results. Default dplyr::bind_rows. fun_dist sf, terra, chopin functions. ... Arguments passed argument fun_dist. second place get vector raster dataset want extract calculate values. example, raster dataset vector-raster overlay performed.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process a given function over multiple large rasters — par_multirasters","text":"data.frame object computation results. entries results, consult function used fun_dist argument.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Process a given function over multiple large rasters — par_multirasters","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/par_multirasters.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Process a given function over multiple large rasters — par_multirasters","text":"","code":"if (FALSE) { library(terra) library(sf) library(chopin) library(future) library(doFuture) sf::sf_use_s2(FALSE) registerDoFuture() plan(multicore)  ncpath <- system.file(\"extdata/nc_hierarchy.gpkg\", package = \"chopin\") nccnty <- terra::vect(ncpath, layer = \"county\") ncelev <-   terra::unwrap(     readRDS(       system.file(\"extdata/nc_srtm15_otm.rds\", package = \"chopin\")     )   ) terra::crs(ncelev) <- \"EPSG:5070\" names(ncelev) <- c(\"srtm15\") tdir <- tempdir(check = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test1.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test2.tif\"), overwrite = TRUE) terra::writeRaster(ncelev, file.path(tdir, \"test3.tif\"), overwrite = TRUE) testfiles <- list.files(tdir, pattern = \"tif$\", full.names = TRUE)  res <- par_multirasters(   filenames = testfiles,   fun_dist = extract_at_poly,   polys = nccnty,   surf = ncelev,   id = \"GEOID\",   func = \"mean\" ) }"},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":null,"dir":"Reference","previous_headings":"","what":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"Regular grid points mainland United States 1km spatial resolution","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"","code":"prediction_grid"},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"data frame 8,092,995 rows three variables: site_id Unique point identifier. Arbitrarily generated. lon Longitude lat Latitude","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"Mainland United States polygon obtained US Census Bureau.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"Coordinates EPSG:5070 (Conus Albers Equal Area)","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/prediction_grid.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Regular grid points in the mainland United States at 1km spatial resolution — prediction_grid","text":"","code":"data(\"prediction_grid\", package = \"chopin\")"},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":null,"dir":"Reference","previous_headings":"","what":"Align vector CRS to raster's — reproject_b2r","title":"Align vector CRS to raster's — reproject_b2r","text":"Align vector CRS raster's","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Align vector CRS to raster's — reproject_b2r","text":"","code":"reproject_b2r(vector = NULL, raster = NULL)"},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Align vector CRS to raster's — reproject_b2r","text":"vector sf/stars/SpatVector/SpatRaster object raster SpatRaster object","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Align vector CRS to raster's — reproject_b2r","text":"Reprojected object class vector","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Align vector CRS to raster's — reproject_b2r","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_b2r.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Align vector CRS to raster's — reproject_b2r","text":"","code":"library(terra) library(sf) options(sf_use_s2 = FALSE) ncpath <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") elev <- system.file(\"ex/elev.tif\", package = \"terra\") nc <- terra::vect(ncpath) elev <- terra::rast(elev) reproject_b2r(nc, elev) #>  class       : SpatVector  #>  geometry    : polygons  #>  dimensions  : 100, 14  (geometries, attributes) #>  extent      : -84.32377, -75.45658, 33.88216, 36.58977  (xmin, xmax, ymin, ymax) #>  coord. ref. : lon/lat WGS 84 (EPSG:4326)  #>  names       :  AREA PERIMETER CNTY_ CNTY_ID      NAME  FIPS    FIPSNO CRESS_ID #>  type        : <num>     <num> <num>   <num>     <chr> <chr>     <num>    <int> #>  values      : 0.114     1.442  1825    1825      Ashe 37009 3.701e+04        5 #>                0.061     1.231  1827    1827 Alleghany 37005   3.7e+04        3 #>                0.143      1.63  1828    1828     Surry 37171 3.717e+04       86 #>  BIR74 SID74 (and 4 more) #>  <num> <num>              #>   1091     1              #>    487     0              #>   3188     5"},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":null,"dir":"Reference","previous_headings":"","what":"Check coordinate system then reproject — reproject_std","title":"Check coordinate system then reproject — reproject_std","text":"input checked whether coordinate system present. , reprojected CRS specified crs_standard.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check coordinate system then reproject — reproject_std","text":"","code":"reproject_std(input, crs_standard = \"EPSG:4326\")"},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check coordinate system then reproject — reproject_std","text":"input Input object one sf terra::Spat* object crs_standard character(1). standard definition coordinate reference system. Default \"EPSG:4326\" Consult epsg.io details CRS.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check coordinate system then reproject — reproject_std","text":"(reprojected) sf SpatVector object.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Check coordinate system then reproject — reproject_std","text":"function works well EPSG codes.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Check coordinate system then reproject — reproject_std","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/reproject_std.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Check coordinate system then reproject — reproject_std","text":"","code":"library(sf) library(terra) options(sf_use_s2 = FALSE)  base_crs <- \"EPSG:5070\" nc_path <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc_sf <- sf::st_read(nc_path) #> Reading layer `nc.gpkg' from data source  #>   `/home/runner/work/_temp/Library/sf/gpkg/nc.gpkg' using driver `GPKG' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 reproject_std(nc_sf, base_crs) #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: 1054293 ymin: 1348025 xmax: 1833499 ymax: 1689236 #> Projected CRS: NAD83 / Conus Albers #> First 10 features: #>     AREA PERIMETER CNTY_ CNTY_ID        NAME  FIPS FIPSNO CRESS_ID BIR74 SID74 #> 1  0.114     1.442  1825    1825        Ashe 37009  37009        5  1091     1 #> 2  0.061     1.231  1827    1827   Alleghany 37005  37005        3   487     0 #> 3  0.143     1.630  1828    1828       Surry 37171  37171       86  3188     5 #> 4  0.070     2.968  1831    1831   Currituck 37053  37053       27   508     1 #> 5  0.153     2.206  1832    1832 Northampton 37131  37131       66  1421     9 #> 6  0.097     1.670  1833    1833    Hertford 37091  37091       46  1452     7 #> 7  0.062     1.547  1834    1834      Camden 37029  37029       15   286     0 #> 8  0.091     1.284  1835    1835       Gates 37073  37073       37   420     0 #> 9  0.118     1.421  1836    1836      Warren 37185  37185       93   968     4 #> 10 0.124     1.428  1837    1837      Stokes 37169  37169       85  1612     1 #>    NWBIR74 BIR79 SID79 NWBIR79                           geom #> 1       10  1364     0      19 MULTIPOLYGON (((1288822 156... #> 2       10   542     3      12 MULTIPOLYGON (((1307047 158... #> 3      208  3616     6     260 MULTIPOLYGON (((1378070 157... #> 4      123   830     2     145 MULTIPOLYGON (((1765395 166... #> 5     1066  1606     3    1197 MULTIPOLYGON (((1661822 163... #> 6      954  1838     5    1237 MULTIPOLYGON (((1703230 163... #> 7      115   350     2     139 MULTIPOLYGON (((1765395 166... #> 8      254   594     2     371 MULTIPOLYGON (((1716728 165... #> 9      748  1190     2     844 MULTIPOLYGON (((1566041 161... #> 10     160  2038     5     176 MULTIPOLYGON (((1415754 158...  nc_vect <- terra::vect(nc_sf) reproject_std(nc_vect, base_crs) #>  class       : SpatVector  #>  geometry    : polygons  #>  dimensions  : 100, 14  (geometries, attributes) #>  extent      : 1054293, 1833499, 1348025, 1689236  (xmin, xmax, ymin, ymax) #>  coord. ref. : NAD83 / Conus Albers (EPSG:5070)  #>  names       :  AREA PERIMETER CNTY_ CNTY_ID      NAME  FIPS    FIPSNO CRESS_ID #>  type        : <num>     <num> <num>   <num>     <chr> <chr>     <num>    <int> #>  values      : 0.114     1.442  1825    1825      Ashe 37009 3.701e+04        5 #>                0.061     1.231  1827    1827 Alleghany 37005   3.7e+04        3 #>                0.143      1.63  1828    1828     Surry 37171 3.717e+04       86 #>  BIR74 SID74 (and 4 more) #>  <num> <num>              #>   1091     1              #>    487     0              #>   3188     5"},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":null,"dir":"Reference","previous_headings":"","what":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"poly_in poly_weight different classes, poly_weight converted class poly_in.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"","code":"summarize_aw(   poly_in = NULL,   poly_weight = NULL,   target_fields = NULL,   id_poly_in = \"ID\",   fun = stats::weighted.mean )"},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"poly_in sf/SpatVector object weighted means calculated. poly_weight sf/SpatVector object weighted means calculated. target_fields character. Field names calculate area-weighted . id_poly_in character(1). unique identifier polygon poly_in. Default \"ID\". fun function(1). function calculate weighted summary. Default stats::weighted.mean. function must w argument.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"data.frame numeric fields area-weighted means.","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"Insang Song geoissong@gmail.com","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_aw.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Area weighted summary using two polygon sf or SpatVector objects — summarize_aw","text":"","code":"# package library(sf) sf_use_s2(FALSE) nc <- sf::st_read(system.file(\"shape/nc.shp\", package=\"sf\")) #> Reading layer `nc' from data source  #>   `/home/runner/work/_temp/Library/sf/shape/nc.shp' using driver `ESRI Shapefile' #> Simple feature collection with 100 features and 14 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965 #> Geodetic CRS:  NAD27 nc <- sf::st_transform(nc, 5070) pp <- sf::st_sample(nc, size = 300) pp <- sf::st_as_sf(pp) pp[[\"id\"]] <- seq(1, nrow(pp)) sf::st_crs(pp) <- \"EPSG:5070\" ppb <- sf::st_buffer(pp, nQuadSegs=180, dist = units::set_units(20, \"km\"))  system.time(ppb_nc_aw <- summarize_aw(ppb, nc, c(\"BIR74\", \"BIR79\"), \"id\")) #>    user  system elapsed  #>   0.339   0.008   0.347  summary(ppb_nc_aw) #>      BIR74             BIR79                  geometry   #>  Min.   :  265.1   Min.   :  348.3   POLYGON      :300   #>  1st Qu.: 1932.8   1st Qu.: 2422.2   epsg:5070    :  0   #>  Median : 3116.3   Median : 3855.7   +proj=aea ...:  0   #>  Mean   : 4006.6   Mean   : 5166.8                       #>  3rd Qu.: 4855.9   3rd Qu.: 6216.7                       #>  Max.   :16721.9   Max.   :23772.3                       #### Example of summarize_aw ends ####"},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"Calculate Sum Exponentially Decaying Contributions (SEDC) covariates","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"","code":"summarize_sedc(   point_from = NULL,   point_to = NULL,   id = NULL,   sedc_bandwidth = NULL,   threshold = NULL,   target_fields = NULL )"},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"point_from SpatVector object. Locations sum SEDCs calculated. point_to SpatVector object. Locations SEDC calculated. id character(1). Name unique id field point_to. sedc_bandwidth numeric(1). Distance source concentration reduced exp(-3) (approximately -95 %) threshold numeric(1). computational efficiency, nearest points threshold selected. 2 * sedc_bandwidth applied value remains NULL. target_fields character. Field names calculate SEDC.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"data.frame (tibble) object input field names suffix \"_sedc\" sums EDC stored. Additional attributes attached EDC information. attr(result, \"sedc_bandwidth\"): bandwidth concentration reduces approximately five percent attr(result, \"sedc_threshold\"): threshold distance emission source points excluded beyond ","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"Distance calculation done terra functions internally. Thus, function internally converts sf objects point_* arguments terra. Please note NA values input ignored SEDC calculation.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"Messier KP, Akita Y, & Serre ML. (2012). Integrating Address Geocoding, Land Use Regression, Spatiotemporal Geostatistical Estimation Groundwater Tetrachloroethylene. Environmental Science & Technology 46(5), 2772-2780. Wiesner C. (n.d.). Euclidean Sum Exponentially Decaying Contributions Tutorial","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/summarize_sedc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Sum of Exponentially Decaying Contributions (SEDC) covariates — summarize_sedc","text":"","code":"library(terra) library(sf) set.seed(101) ncpath <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc <- terra::vect(ncpath) nc <- terra::project(nc, \"EPSG:5070\") pnt_from <- terra::centroids(nc, inside = TRUE) pnt_from <- pnt_from[, \"NAME\"] pnt_to <- terra::spatSample(nc, 100L) pnt_to$pid <- seq(1, 100) pnt_to <- pnt_to[, \"pid\"] pnt_to$val1 <- rgamma(100L, 1, 0.05) pnt_to$val2 <- rgamma(100L, 2, 1)  vals <- c(\"val1\", \"val2\") summarize_sedc(pnt_from, pnt_to, \"NAME\", 1e5, 2e5, vals) #> Joining with `by = join_by(from_id)` #> Joining with `by = join_by(to_id)` #> Joining with `by = join_by(from_id, to_id)` #> # A tibble: 100 × 3 #>    NAME      val1_sedc val2_sedc #>    <chr>         <dbl>     <dbl> #>  1 Alamance       66.3      6.71 #>  2 Alexander      98.0     11.7  #>  3 Alleghany     135.       8.57 #>  4 Anson          50.0      5.23 #>  5 Ashe          143.       8.42 #>  6 Avery          76.1      8.76 #>  7 Beaufort       58.8      6.29 #>  8 Bertie         70.1      7.85 #>  9 Bladen         79.5      6.82 #> 10 Brunswick      54.3      5.34 #> # ℹ 90 more rows"},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate and repair input vector data — vect_valid_repair","title":"Validate and repair input vector data — vect_valid_repair","text":"tries repairing input vector data. Vector validity violation usually appears polygon data self-crossing hole orders. function pass input_vector object sf::st_make_valid (input_vector sf) terra::makeValid (input_vector SpatVector). May take time depending geometry complexity.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate and repair input vector data — vect_valid_repair","text":"","code":"vect_valid_repair(input_vector)"},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate and repair input vector data — vect_valid_repair","text":"input_vector One sf vect class. Target points computation.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate and repair input vector data — vect_valid_repair","text":"repaired sf SpatVector object depending class input_vector.","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Validate and repair input vector data — vect_valid_repair","text":"function works GEOS (>=3.8).","code":""},{"path":[]},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Validate and repair input vector data — vect_valid_repair","text":"Insang Song","code":""},{"path":"https://kyle-messier.github.io/chopin/reference/vect_valid_repair.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Validate and repair input vector data — vect_valid_repair","text":"","code":"if (FALSE) { library(terra) library(sf) ncpath <- system.file(\"gpkg/nc.gpkg\", package = \"sf\") nc <- terra::vect(ncpath)  nc_valid <- vect_valid_repair(nc) }"}]
